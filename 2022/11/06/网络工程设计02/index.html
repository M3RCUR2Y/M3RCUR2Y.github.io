<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>网络工程设计02——ensp基础 | M3RCUR2Y</title><meta name="author" content="MERCURZY"><meta name="copyright" content="MERCURZY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="本文主要用于快速熟悉ensp操作，完成网络工程设计拓扑设计部分，详细教程请参考：  数据传输网络-三层结构体系：  核心层： 核心层是互连网络的高速主干网，在设计中应增加冗余组件，使其具备高可靠性，能快速适应通信流量的变化。 设计核心层设备的功能时应避免使用数据包过滤、策略路由等降低转发速率的功能特性，使得核心层具有高速率、低延迟和良好的可管理性。核心层设备覆盖的地理范围不宜过大，连接的设备不宜">
<meta property="og:type" content="article">
<meta property="og:title" content="网络工程设计02——ensp基础">
<meta property="og:url" content="http://example.com/2022/11/06/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A102/index.html">
<meta property="og:site_name" content="M3RCUR2Y">
<meta property="og:description" content="本文主要用于快速熟悉ensp操作，完成网络工程设计拓扑设计部分，详细教程请参考：  数据传输网络-三层结构体系：  核心层： 核心层是互连网络的高速主干网，在设计中应增加冗余组件，使其具备高可靠性，能快速适应通信流量的变化。 设计核心层设备的功能时应避免使用数据包过滤、策略路由等降低转发速率的功能特性，使得核心层具有高速率、低延迟和良好的可管理性。核心层设备覆盖的地理范围不宜过大，连接的设备不宜">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg">
<meta property="article:published_time" content="2022-11-06T15:38:11.000Z">
<meta property="article:modified_time" content="2022-11-10T21:24:19.971Z">
<meta property="article:author" content="MERCURZY">
<meta property="article:tag" content="自学笔记">
<meta property="article:tag" content="计算机网络">
<meta property="article:tag" content="esnp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/06/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A102/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '网络工程设计02——ensp基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-11 05:24:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/bgColor.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="M3RCUR2Y" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://img-blog.csdnimg.cn/img_convert/24c7fae59b92b7310428f816c7bec119.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">M3RCUR2Y</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">网络工程设计02——ensp基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-06T15:38:11.000Z" title="发表于 2022-11-06 23:38:11">2022-11-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-10T21:24:19.971Z" title="更新于 2022-11-11 05:24:19">2022-11-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">网络工程设计</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>94分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="网络工程设计02——ensp基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>本文主要用于快速熟悉ensp操作，完成网络工程设计拓扑设计部分，详细教程请参考：</p>
</blockquote>
<p><strong>数据传输网络-三层结构体系：</strong></p>
<ul>
<li><p><strong>核心层：</strong></p>
<p>核心层是互连网络的高速主干网，在设计中应增加冗余组件，使其具备高可靠性，能快速适应通信流量的变化。 设计核心层设备的功能时应避免使用数据包过滤、策略路由等降低转发速率的功能特性，使得核心层具有高速率、低延迟和良好的可管理性。核心层设备覆盖的地理范围不宜过大，连接的设备不宜过多，否则会使得网络的复杂度增大，导致网络性能降低。核心层应包括一条或多条连接外部网络的专用链路，使得可以高效地访问互联网。</p>
</li>
<li><p><strong>汇聚层：</strong></p>
<p>汇聚层是核心层与接入层之间的分界点，应实现资源访问控制和流量控制等功能。汇聚层应该对核心层隐藏接入层的详细信息，不管划分了多少个子网，汇聚层向核心路由器发布路由通告时，只通告各个子网汇聚后的超网地址。 如果局域网中运行了以太网和弹性分组环等不同类型的子网，或者运行了不同路由算法的区域网络，可以通过汇聚层设备完成路由汇总和协议转换功能。</p>
</li>
<li><p><strong>接入层：</strong></p>
<p>接入层提供网络接入服务，并解决本地网段内用户之间互相访问的需求，要提供足够的带宽，使得本地用户之间可以高速访问；接入层还应提供一部分管理功能，例如MAC地址认证、用户认证、计费管理等；接入层要负责收集用户信息（例如用户U地址、MAC地址、访问日志等），作为计费和排错的依据。</p>
</li>
</ul>
<blockquote>
<p>接口配置比较简单，正文中实验步骤都跳过了，不清楚可以百度</p>
</blockquote>
<h1 id="1、VRP基础操作"><a href="#1、VRP基础操作" class="headerlink" title="1、VRP基础操作"></a>1、VRP基础操作</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//关闭信息提示</span></span><br><span class="line">undo info en</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看路由器基本信息</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;display version</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 display ip interface brief 命令查看接口与 IP 相关摘要信息</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]display ip interface brief</span><br><span class="line">dis ip int br</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看路由器配置信息</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;display ip routing-table</span><br></pre></td></tr></table></figure>

<h2 id="1-1、通过Telent登录系统"><a href="#1-1、通过Telent登录系统" class="headerlink" title="1.1、通过Telent登录系统"></a>1.1、通过Telent登录系统</h2><p>为了方便公司员工对机房设备进行远程管理和维护，需要在路由器上配置 Telnet 功能。为了提高网络安全性，用户在 Telnet 时使用密码认证，只有通过认证的用户才有权限登录设备。  </p>
<h3 id="拓扑及设备信息："><a href="#拓扑及设备信息：" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p><img src="https://img-blog.csdnimg.cn/460fc1b6910c445cae02aec280b92272.png" alt="请添加图片描述"></p>
<h3 id="1、配置-Telnet-的密码验证"><a href="#1、配置-Telnet-的密码验证" class="headerlink" title="1、配置 Telnet 的密码验证"></a>1、配置 Telnet 的密码验证</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//配置Telnet的密码验证</span></span><br><span class="line">[<span class="variable constant_">R1</span>]user-interface vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ui-vty0-<span class="number">4</span>]authentication-mode password</span><br><span class="line"><span class="title class_">Please</span> configure the login password (maximum length <span class="number">16</span>):[此处输入密码]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在其他设备连接</span></span><br><span class="line">&lt;<span class="variable constant_">PC</span>-<span class="number">1</span>&gt;telnet <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Trying</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> ...</span><br><span class="line"><span class="title class_">Press</span> <span class="variable constant_">CTRL</span>+K to abor</span><br><span class="line"><span class="title class_">Connected</span> to <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> ...</span><br><span class="line"><span class="title class_">Login</span> authentication</span><br><span class="line"><span class="title class_">Password</span>:[此处输入密码] </span><br><span class="line"><span class="comment">//登录成功后，可以继续使用命令 display users 查看已经登录的用户信息。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]display users</span><br><span class="line"><span class="title class_">User</span>-<span class="title class_">Intf</span> <span class="title class_">Delay</span> <span class="title class_">Type</span> <span class="title class_">Network</span> <span class="title class_">Address</span> <span class="title class_">AuthenStatus</span> <span class="title class_">AuthorcmdFlag</span></span><br><span class="line">+ <span class="number">0</span> <span class="variable constant_">CON</span> <span class="number">0</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> no <span class="title class_">Username</span> : <span class="title class_">Unspecified</span></span><br><span class="line"><span class="number">34</span> <span class="variable constant_">VTY</span> <span class="number">0</span> <span class="number">00</span>:<span class="number">01</span>:<span class="number">26</span> <span class="variable constant_">TEL</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> pass no U</span><br><span class="line">sername : <span class="title class_">Unspecified</span></span><br><span class="line"><span class="number">35</span> <span class="variable constant_">VTY</span> <span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">TEL</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> pass no U</span><br><span class="line">sername : <span class="title class_">Unspecified</span></span><br></pre></td></tr></table></figure>

<h3 id="2、-配置-Telnet-区分不同用户的权限"><a href="#2、-配置-Telnet-区分不同用户的权限" class="headerlink" title="2、 配置 Telnet 区分不同用户的权限"></a>2、 配置 Telnet 区分不同用户的权限</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R1 上配置 Telnet 的用户级别为 1（监控级）。普通员工仅使用密码登录设备，只能使用 display 等命令监控设备。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]user-interface vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ui-vty0-<span class="number">4</span>]authentication-mode password</span><br><span class="line">[<span class="variable constant_">R1</span>-ui-vty0-<span class="number">4</span>]set authentication password cipher [此处输入密码]</span><br><span class="line">[<span class="variable constant_">R1</span>-ui-vty0-<span class="number">4</span>]user privilege level <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，VTY 用户界面的用户级别为 0（参观级），只能使用 ping、 tracert 等这些网络诊断命令。  配置完成后，将 R2 模拟成普通用户设备，测试到 R1 的 Telnet 连接。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;<span class="variable constant_">R2</span>&gt;telnet <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Trying</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> ...</span><br><span class="line"><span class="title class_">Press</span> <span class="variable constant_">CTRL</span>+K to abort</span><br><span class="line"><span class="title class_">Connected</span> to <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> ...</span><br><span class="line"><span class="title class_">Login</span> authentication</span><br><span class="line"><span class="title class_">Password</span>:</span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;system-view</span><br><span class="line">^</span><br><span class="line"><span class="title class_">Error</span>: <span class="title class_">Unrecognized</span> command found at <span class="string">&#x27;^&#x27;</span> position.</span><br><span class="line"><span class="comment">//试图进入R1的系统视图的时候被拒绝，原因是用户等级不够</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>STELNET登陆系统本次项目暂时用不上，就不写了</p>
</blockquote>
<h2 id="1-2、通过FTP进行文件操作"><a href="#1-2、通过FTP进行文件操作" class="headerlink" title="1.2、通过FTP进行文件操作"></a>1.2、通过FTP进行文件操作</h2><h3 id="拓扑及设备信息：-1"><a href="#拓扑及设备信息：-1" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p><img src="https://img-blog.csdnimg.cn/c10ec91c03e34db4bacdebf51352a799.png" alt="请添加图片描述"></p>
<h3 id="1、配置路由器为FTP-Client"><a href="#1、配置路由器为FTP-Client" class="headerlink" title="1、配置路由器为FTP Client"></a>1、配置路由器为FTP Client</h3><p>在电脑上创建文件夹”FTP-Huawei”作为FTP服务器的文件夹，在该路径下再创建子文件夹”Config”，该文件夹下创建测试文件test.txt。</p>
<p>创建完成后，将”FTP-Huawei”的路径设置为FTP服务器配置的文件根目录。</p>
<p><img src="https://img-blog.csdnimg.cn/5f375f204650409fbcd05767110abf6a.png" alt="请添加图片描述"></p>
<p>FTP Server上没有默认用户名和密码，每次在R1上连接服务器时，会自动创建新用户。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//本次使用用户名 10.0.2.1，密码 huawei</span></span><br><span class="line"><span class="comment">//此处设置用户名</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;ftp <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line"><span class="title class_">Trying</span> <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span> ...</span><br><span class="line"><span class="title class_">Press</span> <span class="variable constant_">CTRL</span>+K to abort</span><br><span class="line"><span class="title class_">Connected</span> to <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span>.</span><br><span class="line"><span class="number">220</span> <span class="title class_">FtpServerTry</span> <span class="title class_">FtpD</span> <span class="keyword">for</span> free</span><br><span class="line"><span class="title class_">User</span>(<span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span>:(none)):<span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line"><span class="number">331</span> <span class="title class_">Password</span> required <span class="keyword">for</span> <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span> .</span><br><span class="line"><span class="comment">//此处输入密码</span></span><br><span class="line"><span class="title class_">Enter</span> <span class="attr">password</span>:<span class="comment">//[密码]</span></span><br><span class="line"><span class="number">230</span> <span class="title class_">User</span> <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span> logged <span class="keyword">in</span> , proceed</span><br><span class="line">[<span class="variable constant_">R1</span>-ftp]</span><br></pre></td></tr></table></figure>

<p>连接服务器后的操作：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用命令 ls 查看 FTP 服务器文件夹状态。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ftp]ls</span><br><span class="line"><span class="number">200</span> <span class="title class_">Port</span> command okay.</span><br><span class="line"><span class="number">150</span> <span class="title class_">Opening</span> <span class="variable constant_">ASCII</span> <span class="variable constant_">NO</span>-<span class="variable constant_">PRINT</span> mode data connection <span class="keyword">for</span> ls -l.</span><br><span class="line"><span class="title class_">Config</span></span><br><span class="line"><span class="number">226</span> <span class="title class_">Transfer</span> finished successfully. <span class="title class_">Data</span> connection closed.</span><br><span class="line"><span class="attr">FTP</span>: <span class="number">12</span> <span class="title function_">byte</span>(s) received <span class="keyword">in</span> <span class="number">0.180</span> <span class="title function_">second</span>(s) <span class="number">66.</span>66byte(s)/sec.</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 cd 进入Config文件夹。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ftp]cd <span class="title class_">Config</span></span><br><span class="line"><span class="number">250</span> <span class="string">&quot;/config&quot;</span> is current directory.</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 dir 查看详细的文件属性。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ftp]dir</span><br><span class="line"><span class="number">200</span> <span class="title class_">Port</span> command okay.</span><br><span class="line"><span class="number">150</span> <span class="title class_">Opening</span> <span class="variable constant_">ASCII</span> <span class="variable constant_">NO</span>-<span class="variable constant_">PRINT</span> mode data connection <span class="keyword">for</span> ls -l.</span><br><span class="line">drwxrwxrwx <span class="number">1</span> <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span> nogroup <span class="number">3</span> <span class="title class_">Aug</span> <span class="number">21</span> <span class="number">2013</span> test.<span class="property">txt</span></span><br><span class="line"><span class="number">226</span> <span class="title class_">Transfer</span> finished successfully. <span class="title class_">Data</span> connection closed.</span><br><span class="line"><span class="attr">FTP</span>: <span class="number">66</span> <span class="title function_">byte</span>(s) received <span class="keyword">in</span> <span class="number">0.050</span> <span class="title function_">second</span>(s) <span class="number">1.</span>32Kbyte(s)/sec.</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 get 命令下载 test 到本地路由器。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ftp]get test.<span class="property">txt</span></span><br><span class="line"><span class="number">200</span> <span class="title class_">Port</span> command okay.</span><br><span class="line"><span class="number">150</span> <span class="title class_">Sending</span> test.<span class="property">txt</span> (<span class="number">3</span> bytes). <span class="title class_">Mode</span> <span class="variable constant_">STREAM</span> <span class="title class_">Type</span> <span class="variable constant_">BINARY</span></span><br><span class="line"><span class="number">226</span> <span class="title class_">Transfer</span> finished successfully. <span class="title class_">Data</span> connection closed.</span><br><span class="line"><span class="attr">FTP</span>: <span class="number">3</span> <span class="title function_">byte</span>(s) received <span class="keyword">in</span> <span class="number">17.450</span> <span class="title function_">second</span>(s) .17byte(s)/sec</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 put 命令上传 test 到 FTP 服务器，命名为 new.txt。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ftp]put test.<span class="property">txt</span> <span class="keyword">new</span>.<span class="property">txt</span></span><br><span class="line"><span class="number">200</span> <span class="title class_">Port</span> command okay.</span><br><span class="line"><span class="number">150</span> <span class="title class_">Opening</span> <span class="variable constant_">BINARY</span> data connection <span class="keyword">for</span> <span class="keyword">new</span>.<span class="property">txt</span></span><br><span class="line"><span class="number">226</span> <span class="title class_">Transfer</span> finished successfully. <span class="title class_">Data</span> connection closed.</span><br><span class="line"><span class="attr">FTP</span>: <span class="number">3</span> <span class="title function_">byte</span>(s) sent <span class="keyword">in</span> <span class="number">0.070</span> <span class="title function_">second</span>(s) <span class="number">42.</span>85byte(s)/sec.</span><br></pre></td></tr></table></figure>

<h3 id="2、配置路由器为FTP-Server"><a href="#2、配置路由器为FTP-Server" class="headerlink" title="2、配置路由器为FTP Server"></a>2、配置路由器为FTP Server</h3><p>将路由器配置为 FTP 服务器，可以使得路由器下行的客户端能够上传文件到路由<br>器上，并可直接从 Server 上获取文件。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//打开路由器 R1 的 FTP 服务器功能</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;system-view</span><br><span class="line">[<span class="variable constant_">R1</span>]ftp server enable</span><br><span class="line"><span class="comment">//设置 FTP 登录的用户名为 ftp， 密码为 huawei，设置文件夹目录 flash： //配置 FTP 用户可访问的目录为 fash：，用户优先级为 15，服务类型为 ftp</span></span><br><span class="line">[<span class="variable constant_">R1</span>]aaa</span><br><span class="line">[<span class="variable constant_">R1</span>-aaa]local-user ftp password cipher hawei</span><br><span class="line">[<span class="variable constant_">R1</span>-aaa]local-user ftp ftp-directory <span class="attr">flash</span>:</span><br><span class="line">[<span class="variable constant_">R1</span>-aaa]local-user ftp service-type ftp</span><br><span class="line">[<span class="variable constant_">R1</span>-aaa]local-user ftp privilege level <span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>配置完成后， 在本地创建测试文件 test-user.txt，并设置客户端信息如下图。配置服务器地址为 10.0.1.254，用户名为 ftp，密码为 huawei，然后点击“登录”按钮。  </p>
<p><img src="https://img-blog.csdnimg.cn/1248a45773874cbbb19df400770f77c6.png" alt="请添加图片描述"></p>
<p>登录成功后，可选择文件 test-user，并点击向右箭头传送至 FTP 服务器，可观察到上传文件成功。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在R1上查看目录下的文件。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]dir</span><br><span class="line"><span class="title class_">Directory</span> <span class="keyword">of</span> <span class="attr">flash</span>:/</span><br><span class="line"><span class="title class_">Idx</span> <span class="title class_">Attr</span> <span class="title class_">Size</span>(<span class="title class_">Byte</span>) <span class="title class_">Date</span> <span class="title class_">Time</span>(<span class="variable constant_">LMT</span>) <span class="title class_">FileName</span></span><br><span class="line">……</span><br><span class="line"><span class="number">3</span> -rw- <span class="number">0</span> <span class="title class_">Sep</span> <span class="number">09</span> <span class="number">2013</span> <span class="number">03</span>:<span class="number">32</span>:<span class="number">58</span> test-user.<span class="property">txt</span></span><br><span class="line"><span class="number">4</span> -rw- <span class="number">0</span> <span class="title class_">Sep</span> <span class="number">09</span> <span class="number">2013</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">47</span> test.<span class="property">txt</span></span><br><span class="line"><span class="number">980</span>,<span class="number">052</span> <span class="variable constant_">KB</span> total (<span class="number">700</span>,<span class="number">320</span> <span class="variable constant_">KB</span> free)</span><br></pre></td></tr></table></figure>



<h1 id="2、交换机基础配置"><a href="#2、交换机基础配置" class="headerlink" title="2、交换机基础配置"></a>2、交换机基础配置</h1><h2 id="2-1、交换机基础配置"><a href="#2-1、交换机基础配置" class="headerlink" title="2.1、交换机基础配置"></a>2.1、交换机基础配置</h2><h3 id="拓扑及设备信息：-2"><a href="#拓扑及设备信息：-2" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>S1 和 S2 为接入层交换机， S3为汇聚层交换机。</p>
<p>对三台新交换机进行基本配置， 保证交换机间的接口使用全双工模式，并根据需要配置接口速率。</p>
<p><img src="https://img-blog.csdnimg.cn/289df1b3fb254db1834a67d1400b977f.png" alt="请添加图片描述"></p>
<p>###1、配置交换机双工模式</p>
<p>在自协商模式下，接口的双工模式是和对端接口协商得到的，但协商得到的双工模式可能与实际要求不符。可通过配置双工模式的取值范围来控制协商的结果。例如互连的两个设备对应的接口都支持全&#x2F;半双工，经自协商后工作在半双工模式，与实际要求的全双工模式不符，这时就可以执行命令 auto duplex full 使得接口的可协商双工模式为全双工模式。</p>
<p>缺省情况下，以太网接口自协商双工模式范围为接口所支持的双工模式。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在S1,S2,S3三台交换机接口下先通过 undo negotiation auto 命令关掉自协商功能，再手工指定双工模式为全双工</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]duplex full</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]duplex full</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S3</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]duplex full</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]duplex full</span><br></pre></td></tr></table></figure>

<h3 id="2、配置接口速率"><a href="#2、配置接口速率" class="headerlink" title="2、配置接口速率"></a>2、配置接口速率</h3><p>在自协商模式下，以太网接口的速率是和对端接口协商得到的。如果协商的速率与实际要求不符，可通过配置速率的取值范围来控制协商的结果。例如互连的两个设备对应的接口经自协商后的速率为10Mbit&#x2F;s，与实际要求的100Mbit&#x2F;s不符，可通过执行命令auto speed 100配置使得接口可协商的速率为 100Mbit&#x2F;s。  </p>
<p>缺省情况下，以太网接口自协商速率范围为接口支持的所有速率。在非自协商模式下，需手动配置接口速率，避免发生无法正常通讯的情况。在非自协商模式时，缺省情况下，以太网接口的速率为接口支持的最大速率。</p>
<p>根据网络需要调整接口速率。由于网络用户较少，配置 GE 接口速率为 100Mbit&#x2F;s，Ethernet 接口配置速率为 10Mbit&#x2F;s。 </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在三台交换机接口下配置速率。首先关闭接口自协商模式，并配置以太网接口的速率。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]inter <span class="title class_">Ethernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]speed <span class="number">10</span></span><br><span class="line"><span class="comment">//用同样的方法配置另外两台设备接口的速率。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]interface ethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]speed <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]speed <span class="number">100</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S3</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]speed <span class="number">100</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo negotiation auto</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]speed <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2、ARP及Proxy-ARP"><a href="#2-2、ARP及Proxy-ARP" class="headerlink" title="2.2、ARP及Proxy ARP"></a>2.2、ARP及Proxy ARP</h2><blockquote>
<p>本项目暂时用不上，了解即可。</p>
</blockquote>
<p>ARP（ Address Resolution Protocol）是用来将 IP 地址解析为 MAC 地址的协议。 ARP 表项可以分为动态和静态两种类型。 动态 ARP 是利用 ARP 广播报文，动态执行并自动进行 IP地址到以太网 MAC 地址的解析，无需网络管理员手工处理。静态 ARP，建立 IP 地址和 MAC地址之间固定的映射关系，在主机和路由器上不能动态调整此映射关系， 需要网络管理员手工添加。 设备上有一个 ARP 高速缓存（ ARP cache），用来存放 IP 地址到 MAC 地址的映射表，利用 ARP 请求和应答报文来缓存映射表，以便能正确的把三层数据包封装成二层数据正，达到快速封装数据帧，正确转发数据的目的。 另外 ARP 还有扩展应用功能，比如 Proxy ARP 功能。</p>
<p>Proxy ARP，即代理 ARP， 当主机上没有配置缺省网关地址（即不知道如何到达本地网络的网关设备），可以发送一个广播 ARP 请求（请求目的主机的 MAC 地址），使能 Proxy ARP功能的路由器收到这样的请求后， 在确认请求地址可达后，会使用自身的 MAC 地址作为该ARP 请求的回应，使得处于不同物理网络的同一网段的主机之间可以正常的相互通信。</p>
<h1 id="3、VLAN"><a href="#3、VLAN" class="headerlink" title="3、VLAN"></a>3、VLAN</h1><blockquote>
<p>比较简单，快速过一遍即可</p>
</blockquote>
<h2 id="3-1、VLAN-基础配置及-Access-接口"><a href="#3-1、VLAN-基础配置及-Access-接口" class="headerlink" title="3.1、VLAN 基础配置及 Access 接口"></a>3.1、VLAN 基础配置及 Access 接口</h2><p><strong>原理概述：</strong></p>
<p>​		早期的局域网技术是基于总线型结构的，总线型拓扑结构是由一根单电缆连接着所有主机，这种局域网技术存在着冲突域问题，即所有用户都在一个冲突域中，那么同一时间内只有一台主机能发送消息，从任意设备发出的消息都会被其他所有主机接收到，用户可能收到大量不需要的报文，而且所有主机共享一条传输通道，任意主机之间都可以直接互相访问，无法控制信息的安全。</p>
<p>​		为了避免冲突域，同时扩展传统局域网，以接入更多计算机，可以采用在局域网中使用二层交换机，交换机能有效隔离冲突域，但是由于所有计算机仍处于同一个广播域，任意设备都能接收到所有报文，不但降低了网络的效率，而且还降低了安全性，即广播域和信息安全问题依旧存在。 为了能减少广播，提高局域网安全性，人们使用虚拟局域网即 VLAN 技术把一个物理的 LAN 在逻辑上划分成多个广播域。 VLAN 内的主机间可以直接通信，而VLAN 间不能直接互通。这样，广播报文被限制在一个 VLAN 内，同时也提高了网络安全性。 不同的 VLAN 使用不同的 VLAN ID 区分， VLAN ID 的范围是 0－ 4095，可配置的值为1－ 4094， 0 和 4095 为保留值。</p>
<p>​		Access 接口是交换机上用来连接用户主机的接口。当 Access 接口从主机收到一个不带VLAN 标签的数据帧时，会给该数据帧加上与PVID 一致的VLAN 标签（ PVID 可手工配置，默认是 1，即所有交换机上的接口默认都属于 VLAN 1）。当 Access 接口要发送一个带 VLAN标签的数据帧给主机时，首先检查该数据帧的 VLAN ID 是否与自己的 PVID 相同，若相同，则去掉 VLAN 标签后发送该数据帧给主机；若不相同，直接丢弃该数据帧。  </p>
<h3 id="拓扑及设备信息：-3"><a href="#拓扑及设备信息：-3" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p><img src="https://img-blog.csdnimg.cn/289df1b3fb254db1834a67d1400b977f.png" alt="请添加图片描述"></p>
<h3 id="1、创建VLAN"><a href="#1、创建VLAN" class="headerlink" title="1、创建VLAN"></a>1、创建VLAN</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 S1 上使用两条命令分别创建 VLAN 10 和 VLAN 20。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]vlan <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S1</span>-vlan10]vlan <span class="number">20</span></span><br><span class="line"><span class="comment">//在 S2 上使用一条命令 vlan batch 创建 VLAN 30 和 VLAN 40。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]vlan batch <span class="number">30</span> <span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，在 S1 和 S2 上使用 display vlan 命令查看 VLAN 的相关信息。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display vlan</span><br><span class="line"><span class="title class_">The</span> total number <span class="keyword">of</span> vlans is : <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> common <span class="attr">UT</span>: ...</span><br><span class="line"><span class="number">10</span> common</span><br><span class="line"><span class="number">20</span> common</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]display vlan</span><br><span class="line"><span class="title class_">The</span> total number <span class="keyword">of</span> vlans is : <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> common <span class="attr">UT</span>:...</span><br><span class="line"><span class="number">30</span> common</span><br><span class="line"><span class="number">40</span> common</span><br><span class="line"><span class="comment">//可以观察到， S1 和 S2 都已经成功创建了相应 VLAN，但目前没有任何接口加入所创建的 VLAN 10 与 20 中，默认情况下交换机上所有接口都属于 VLAN 1。</span></span><br></pre></td></tr></table></figure>

<h3 id="2、配置Access接口"><a href="#2、配置Access接口" class="headerlink" title="2、配置Access接口"></a>2、配置Access接口</h3><p>按照拓扑，使用命令 port link-type access 配置所有 S1 和 S2 交换机上连接 PC 的接口类型为 Access 类型接口，并使用命令 port default vlan 配置接口的缺省 VLAN 并同时加入相应 VLAN 中。 缺省情况下，所有接口的缺省 VLAN ID 为1 。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">S1</span>]interface ethernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface ethernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface ethernet0/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">20</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface ethernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">30</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface ethernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，查看 S1 与 S2 上的 VLAN 信息</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display vlan</span><br><span class="line"><span class="title class_">The</span> total number <span class="keyword">of</span> vlans is : <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="number">10</span> common <span class="attr">UT</span>:<span class="title class_">Eth0</span>/<span class="number">0</span>/<span class="number">1</span>(D) <span class="title class_">Eth0</span>/<span class="number">0</span>/<span class="number">2</span>(D)</span><br><span class="line"><span class="number">20</span> common <span class="attr">UT</span>:<span class="title class_">Eth0</span>/<span class="number">0</span>/<span class="number">3</span>(D)</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]display vlan</span><br><span class="line"><span class="title class_">The</span> total number <span class="keyword">of</span> vlans is : <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="number">30</span> common <span class="attr">UT</span>:<span class="title class_">Eth0</span>/<span class="number">0</span>/<span class="number">1</span>(D)</span><br><span class="line"><span class="number">40</span> common <span class="attr">UT</span>:<span class="title class_">Eth0</span>/<span class="number">0</span>/<span class="number">2</span>(D)</span><br></pre></td></tr></table></figure>

<h3 id="3、检查配置结果"><a href="#3、检查配置结果" class="headerlink" title="3、检查配置结果"></a>3、检查配置结果</h3><p>​		在交换机上将不同接口加入各自不同的 VLAN 中后，属于相同 VLAN 的接口处于同一个广播域，相互之间可以直接通信。属于不同 VLAN 的接口是处于不同的广播域，相互之间不能直接通信。  </p>
<p>​		在本实验环境中，只有同属于 IT 部门 VLAN10 的两台主机 PC-1 和 PC-2 之间可以互相通信。其他不同部门间的 PC 之间将无法通信。</p>
<p>​		在 IT 部门的终端 PC-1 上分别测试与同部门的终端 PC-2，HR 部门的 PC-3 间的连通性。</p>
 <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">PC</span>&gt;ping -c <span class="number">1</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"><span class="variable constant_">PING</span> <span class="number">10.0</span><span class="number">.1</span><span class="number">.2</span>: <span class="number">56</span> data bytes, press <span class="variable constant_">CTRL_C</span> to <span class="keyword">break</span></span><br><span class="line"><span class="title class_">Reply</span> <span class="keyword">from</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span>: bytes=<span class="number">56</span> <span class="title class_">Sequence</span>=<span class="number">1</span> ttl=<span class="number">255</span> time=<span class="number">50</span> ms</span><br><span class="line">--- <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> ping statistics ---</span><br><span class="line"><span class="number">1</span> <span class="title function_">packet</span>(s) transmitted</span><br><span class="line"><span class="number">1</span> <span class="title function_">packet</span>(s) received</span><br><span class="line"><span class="number">0.00</span>% packet loss</span><br><span class="line">round-trip min/avg/max = <span class="number">50</span>/<span class="number">50</span>/<span class="number">50</span> ms</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">PC</span>&gt;ping <span class="number">1</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"><span class="title class_">From</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>: <span class="title class_">Destination</span> host unreachable</span><br><span class="line"><span class="title class_">From</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>: <span class="title class_">Destination</span> host unreachable</span><br><span class="line"><span class="title class_">From</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>: <span class="title class_">Destination</span> host unreachable</span><br><span class="line"><span class="title class_">From</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>: <span class="title class_">Destination</span> host unreachable</span><br><span class="line"><span class="title class_">From</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>: <span class="title class_">Destination</span> host unreachable</span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到，相同 VLAN 内的 PC 可以互相通信，不同 VLAN 内的 PC 间无法通信。</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2、配置Trunk接口"><a href="#3-2、配置Trunk接口" class="headerlink" title="3.2、配置Trunk接口"></a>3.2、配置Trunk接口</h2><p><strong>原理概述</strong></p>
<p>​		在以太网中，通过划分 VLAN 来隔离广播域和增强网络通讯的安全性。以太网通常由多台交换机组成，为了使 VLAN 的数据帧跨越多台交换机传递，交换机之间互连的链路需要配置为干道链路（ Trunk Link）。 和接入链路不同，干道链路是用来在不同的设备之间（如交换机和路由器之间、交换机和交换机之间）承载多个不同 VLAN 数据的，干道链路是不属于任何一个具体的 VLAN 的， 干道链路可以承载所有的 VLAN 数据，也可以配置为只能传输指定 VLAN 的数据。</p>
<p>​		Trunk 端口一般用于交换机之间连接的端口， Trunk 端口可以属于多个 VLAN，可以接收和发送多个 VLAN 的报文。</p>
<p>​		当 Trunk 端口收到数据帧时， 如果该帧不包含 802.1Q 的 VLAN 标签，将打上该 Trunk端口的 PVID；如果该帧包含 802.1Q 的 VLAN 标签，则不改变。</p>
<p>​		当 Trunk 端口发送数据帧时， 当该所发送帧的 VLAN ID 与端口的 PVID 不同时， 检查是否允许该 VLAN 通过，若允许的话直接透传，不允许就直接丢弃；当该帧的 VLAN ID 与端口的 PVID 相同时，则剥离 VLAN 标签后转发。</p>
<h3 id="拓扑及设备信息：-4"><a href="#拓扑及设备信息：-4" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>​		本实验模拟某公司网络场景，公司规模较大，员工 200 余名，内部网络是一个大的局域网。公司放置了多台接入交换机（如 S1 和 S2）负责员工的网络接入。接入交换机之间通过汇聚交换机 S3 相连。公司通过划分 VLAN 来隔离广播域，由于员工较多，相同部门的员工通过不同交换机接入。为了保证在不同交换机下相同部门的员工能互相通信，需要配置交换机之间链路为干道模式，实现相同 VLAN 跨交换机通信。  </p>
<p><img src="https://img-blog.csdnimg.cn/0f110adddfdb417692e89f216a66a01f.png" alt="请添加图片描述"></p>
<h3 id="1、创建VLAN，配置Access接口"><a href="#1、创建VLAN，配置Access接口" class="headerlink" title="1、创建VLAN，配置Access接口"></a>1、创建VLAN，配置Access接口</h3><p>公司内网需要通过 VLAN 的划分来隔离不同的部门。需要在三台交换机 S1， S2， S3上都分别创建 VLAN 10 和 VLAN 20，研发部员工属于 VLAN 10，市场部员工属于 VLAN 20。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">S1</span>]vlan <span class="number">10</span></span><br><span class="line"><span class="comment">//标记命令：description （参数）</span></span><br><span class="line">[<span class="variable constant_">S1</span>-vlan10]description R$D</span><br><span class="line">[<span class="variable constant_">S1</span>-vlan10]vlan <span class="number">20</span></span><br><span class="line">[<span class="variable constant_">S1</span>-vlan20]description <span class="title class_">Market</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]vlan <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S2</span>-vlan10]description R$D</span><br><span class="line">[<span class="variable constant_">S2</span>-vlan10]vlan <span class="number">20</span></span><br><span class="line">[<span class="variable constant_">S2</span>-vlan20]description <span class="title class_">Market</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S3</span>]vlan <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S3</span>-vlan10]description R$D</span><br><span class="line">[<span class="variable constant_">S3</span>-vlan10]vlan <span class="number">20</span></span><br><span class="line">[<span class="variable constant_">S3</span>-vlan20]description <span class="title class_">Market</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//查看VLAN信息，此处以S3为例</span></span><br><span class="line">&lt;<span class="variable constant_">S3</span>&gt;display vlan</span><br><span class="line"><span class="title class_">The</span> total number <span class="keyword">of</span> vlans is : <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> enable <span class="keyword">default</span> enable disable <span class="variable constant_">VLAN</span> <span class="number">0001</span></span><br><span class="line"><span class="number">10</span> enable <span class="keyword">default</span> enable disable R$D</span><br><span class="line"><span class="number">20</span> enable <span class="keyword">default</span> enable disable <span class="title class_">Market</span></span><br><span class="line"><span class="comment">//可以观察到相关的 VLAN 都已经配置好。也可以使用命令 display vlan summary 查看所配置 VLAN 的简要信息。</span></span><br><span class="line">&lt;<span class="variable constant_">S3</span>&gt;display vlan summary</span><br><span class="line"><span class="keyword">static</span> <span class="attr">vlan</span>:</span><br><span class="line"><span class="title class_">Total</span> <span class="number">3</span> <span class="keyword">static</span> vlan.</span><br><span class="line"><span class="number">1</span> <span class="number">10</span> <span class="number">20</span></span><br><span class="line">dynamic <span class="attr">vlan</span>:</span><br><span class="line"><span class="title class_">Total</span> <span class="number">0</span> dynamic vlan.</span><br><span class="line">reserved <span class="attr">vlan</span>:</span><br><span class="line"><span class="title class_">Total</span> <span class="number">0</span> reserved vlan.</span><br><span class="line"></span><br><span class="line"><span class="comment">//在 S1 上配置 E 0/0/2 和 E 0/0/3 为 Access 接口，并划分到相应的 VLAN 10 内。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>]port <span class="keyword">default</span> vlan <span class="number">10</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span>]port link-type access</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span>]port <span class="keyword">default</span> vlan <span class="number">20</span></span><br><span class="line"><span class="comment">//在 S2 上配置 E 0/0/3 和 E 0/0/4 为 Access 接口，并划分到相应的 VLAN。</span></span><br><span class="line"><span class="comment">//与S1相同，此处略</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 display port vlan 检查 VLAN 和接口配置情况。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display port vlan</span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Link</span> <span class="title class_">Type</span> <span class="variable constant_">PVID</span> <span class="title class_">Trunk</span> <span class="variable constant_">VLAN</span> <span class="title class_">List</span></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> hybrid <span class="number">1</span> -</span><br><span class="line"><span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> access <span class="number">10</span> -</span><br><span class="line"><span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> access <span class="number">20</span> -</span><br><span class="line">[<span class="variable constant_">S2</span>]display port vlan</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="2、配置Trunk接口"><a href="#2、配置Trunk接口" class="headerlink" title="2、配置Trunk接口"></a>2、配置Trunk接口</h3><p>​		在上个步骤中已经将 PC 机所连入的交换机接口划入到了相应的部门 VLAN，现在测试相同部门中的 PC 是否能够通信。  </p>
<blockquote>
<p>几个PC互相ping，此处省略过程</p>
</blockquote>
<p>​		可以观察到此时同部门的 PC 机间不能通信。<br>​		目前在该跨交换机实现不同 VLAN 通信的二层组网拓扑中，虽然与 PC 端相连的交换机接口上创建并划分了 VLAN 信息，但是在交换机与交换机之间相连的接口上并没有相应的VLAN 信息，不能够识别和发送跨越交换机的 VLAN 报文，此时 VLAN 只具有在每台交换机上的本地意义，无法实现相同 VLAN 的跨交换机通信。  </p>
<p>​		为了使得交换机间能够识别和发送跨越交换机的 VLAN 报文，需要用到 <strong>Trunk 技术</strong>，将交换机间相连的接口配置成为 Trunk 接口。 Trunk 接口是交换机上用来与其他交换机连接的接口，能实现同时传递多个VLAN 的流量。在配置的时候要明确配置被允许通过的VLAN，实现对 VLAN 流量传输的控制。  </p>
<p>配置Trunk：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 S1 上配置 E 0/0/1 为 Trunk 接口，允许 VLAN 10 和 VLAN 20 通过。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type trunk</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port trunk allow-pass vlan <span class="number">10</span> <span class="number">20</span></span><br><span class="line"><span class="comment">//在 S2 上配置 E 0/0/2 为 Trunk 接口，允许 VLAN 10 和 VLAN 20 通过。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>]port link-type trunk</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>]port trunk allow-pass vlan <span class="number">10</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在 S3 上配置 GE 0/0/1 和 GE 0/0/2 为 Trunk 接口，允许所有 VLAN 通过。</span></span><br><span class="line">[<span class="variable constant_">S3</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port link-type trunk</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]port trunk allow-pass vlan all</span><br><span class="line">[<span class="variable constant_">S3</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]port link-type trunk</span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]port trunk allow-pass vlan all</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后可以使用命令 display port vlan 来检查 trunk 的配置情况，这里以 S3 为例。</span></span><br><span class="line">[<span class="variable constant_">S3</span>]display port vlan</span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Link</span> <span class="title class_">Type</span> <span class="variable constant_">PVID</span> <span class="title class_">Trunk</span> <span class="variable constant_">VLAN</span> <span class="title class_">List</span></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> trunk <span class="number">1</span> <span class="number">1</span>-<span class="number">4094</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span> trunk <span class="number">1</span> <span class="number">1</span>-<span class="number">4094</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//再次验证发现所有PC都能互通</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3、利用单臂路由实现-VLAN-间路由"><a href="#3-3、利用单臂路由实现-VLAN-间路由" class="headerlink" title="3.3、利用单臂路由实现 VLAN 间路由"></a>3.3、利用单臂路由实现 VLAN 间路由</h2><blockquote>
<p>这部分不一定需要，没有VLAN跨路由通信的需求可以跳过。</p>
</blockquote>
<p><strong>原理概述</strong></p>
<p>以太网中，通常会使用 VLAN 技术隔离二层广播域来减少广播的影响，并增强网络安全性和网络的可管理性，但同时也严格的隔离了不同 VLAN 之间的任何二层流量，分属于不同 VLAN 的用户不能直接互相通信。在现实中，经常会出现某些用户需要跨越 VLAN 实现通信的情况，单臂路由技术就是解决 VLAN 间通信的一种方法。</p>
<p><strong>单臂路由的原理是通过一台路由器，使 VLAN 间互通数据通过路由器进行三层转发</strong>。如果在路由器上为每个 VLAN 分配一个单独的路由器物理接口，随着 VLAN 数量的增加，必然需要更多的接口，而路由器能提供的接口数量比较有限，所以<strong>在路由器的一个物理接口上通过配置子接口（即逻辑接口）的方式来实现以一当多的功能</strong>，将是一种非常好的方式，路由器同一物理接口的不同的子接口作为不同 VLAN 的缺省网关，当不同 VLAN 间的用户主机需要通信时，只需将数据包发送给网关，网关处理后再发送至目的主机所在 VLAN，从而实现 VLAN 间通信。 由于从拓扑结构图看，在交换机与路由器之间，数据仅通过一条物理链路传输，故形象的称之为“单臂路由”。  </p>
<h3 id="拓扑及设备信息：-5"><a href="#拓扑及设备信息：-5" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>本实验模拟公司网络场景，路由器 R1 是公司的出口网关，员工 PC 通过接入层交换机（如 S2 和 S3）接入公司网络，接入层交换机又通过汇聚交换机 S1 与路由器 R1 相连。公司内部网络通过划分不同的 VLAN 隔离了不同部门之间的二层通信，保证各部门间的信息安全，但是由于业务需要，经理、市场部和人事部之间需要能实现跨 VLAN 通信，网络管理员决定借助路由器的三层功能，通过配置单臂路由实现三个部门之间跨VLAN 通信的需求。  </p>
<p><img src="https://img-blog.csdnimg.cn/c9e5f43c72004193b744344011e11e29.png" alt="请添加图片描述"></p>
<h3 id="1、创建VLAN并配置Access、Trunk接口"><a href="#1、创建VLAN并配置Access、Trunk接口" class="headerlink" title="1、创建VLAN并配置Access、Trunk接口"></a>1、创建VLAN并配置Access、Trunk接口</h3><p>​		公司为保证隔离不同部门间的二层通信，保障各部门的信息安全，规划不同部门的终端属于不同的 VLAN。 并对 PC 配置相应 IP 地址。  </p>
<blockquote>
<p>此处配置过程省略，可参考前两小节</p>
</blockquote>
<p>（1）在 S2 上创建 VLAN 10 和 VLAN 20，把连接 PC-1 的 E 0&#x2F;0&#x2F;1 和连接 PC-2 的 E 0&#x2F;0&#x2F;2 接口配置为 Access 类型接口，并分别划分到相应的 VLAN 中。  </p>
<p>（2）在 S3 上创建 VLAN 30，把连接 PC-3 的 E 0&#x2F;0&#x2F;1 接口配置为 Access 类型接口，并划分到 VLAN 30。</p>
<p>（3）交换机之间或交换机和路由器之间相连的接口需要传递多个 VLAN 信息，需要配置成为 Trunk 接口。将 S2 和 S3 的 GE 0&#x2F;0&#x2F;2 接口配置成为 Trunk 类型接口，并允许所有 VLAN 通过。  </p>
<p>（4）在 S1 上创建 VLAN 10、 VLAN 20 和 VLAN 30，并配置交换机和路由器相连的接口为Trunk，允许所有 VLAN 通过  </p>
<h3 id="2、配置路由器子接口和IP地址"><a href="#2、配置路由器子接口和IP地址" class="headerlink" title="2、配置路由器子接口和IP地址"></a>2、配置路由器子接口和IP地址</h3><p>由于路由器 R1 只有一个实际的物理接口与交换机 S1 相连，可以在路由器上配置不同的逻辑子接口来作为不同 VLAN 的网关，从而达到节省路由器接口的目的。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R1 上创建子接口 GE 0/0/1.1，配置 IP 地址 10.1.1.254/24，作为人事部网关地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1.1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.1</span>]ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> <span class="number">24</span></span><br><span class="line"><span class="comment">//在 R1 上创建子接口 GE 0/0/1.2，配置 IP 地址 20.1.1.254/24，作为市场部网关地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1.2</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span>]ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.254</span> <span class="number">24</span></span><br><span class="line"><span class="comment">//在 R1 上创建子接口 GE 0/0/1.3，配置 IP 地址 30.1.1.254/24，作为经理的网关地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1.3</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.3</span>]ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.254</span> <span class="number">24</span></span><br><span class="line"><span class="comment">//在 PC-1， PC-2 和 PC-3 上配置 IP 和相应的网关地址后，在 PC-1 上测试与 PC-2 和 PC-3间的连通性。结果是无法通信，原因见3.3概述</span></span><br></pre></td></tr></table></figure>

<h3 id="3、配置路由器子接口封装VLAN"><a href="#3、配置路由器子接口封装VLAN" class="headerlink" title="3、配置路由器子接口封装VLAN"></a>3、配置路由器子接口封装VLAN</h3><p>​		虽然目前已经创建了不同的子接口，并配置了相关 IP 地址，但是仍然无法通信。是由于处于不同VLAN下，不同网段的PC间要实现互相通信，数据包必须通过路由器进行中转。由 S1 发送到 R1 的数据都加上了 VLAN 标签，而路由器作为三层设备，默认无法处理带了VLAN 标签的数据包。因此需要在路由器上的子接口下配置对应 VLAN 的封装，使路由器能够识别和处理 VLAN 标签，包括剥离和封装 VLAN 标签。</p>
<p>在 R1 的子接口 GE 0&#x2F;0&#x2F;1.1 上封装 VLAN 10，在子接口 GE 0&#x2F;0&#x2F;1.2 上封装 VLAN 20，在子接口 GE 0&#x2F;0&#x2F;1.3 上封装 VLAN 30。并开启子接口的 ARP 广播功能。</p>
<p>使用 <strong>dot1q termination vid</strong> 命令配置子接口对一层 tag 报文的终结功能。即配置该命令后，路由器子接口在接收带有 VLAN tag 的报文时，将剥掉 tag 进行三层转发，在发送报文时，会将与该子接口对应 VLAN 的 VLAN tag 添加到报文中。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.1</span>]dot1q termination vid <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>使用 <strong>arp broadcast enable</strong> 命令开启子接口的 ARP 广播功能。如果不配置命令，将会导致该子接口不发送携带有 VLAN tag 的报文  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.1</span>]arp broadcast enable</span><br><span class="line"></span><br><span class="line"><span class="comment">//同理配置 R1 的子接口 GE 0/0/1.2 和 GE 0/0/1/.3。  </span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span>]dot1q termination vid <span class="number">20</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span>]arp broadcast enable</span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span>]interface <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1.3</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.3</span>]dot1q termination vid <span class="number">30</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.3</span>]arp broadcast enable</span><br></pre></td></tr></table></figure>

<p>配置完成后，在路由器 R1 上查看接口状态。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">R1</span>]display ip interface brief</span><br><span class="line">*<span class="attr">down</span>: administratively down</span><br><span class="line">……</span><br><span class="line"><span class="title class_">Interface</span> <span class="variable constant_">IP</span> <span class="title class_">Address</span>/<span class="title class_">Mask</span> <span class="title class_">Physical</span> <span class="title class_">Protocol</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span> unassigned down down</span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> unassigned up down</span><br><span class="line"><span class="comment">//三个子接口的物理状态和协议状态都正常。</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.1</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span>/<span class="number">24</span> up up</span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.254</span>/<span class="number">24</span> up up</span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.3</span> <span class="number">30.1</span><span class="number">.1</span><span class="number">.254</span>/<span class="number">24</span> up up</span><br><span class="line"><span class="title class_">NULL0</span> unassigned up <span class="title function_">up</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看路由器 R1 的路由表。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]display ip routing-table</span><br><span class="line"><span class="title class_">Route</span> <span class="title class_">Flags</span>: R - relay, D - download to fib</span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Routing</span> <span class="title class_">Tables</span>: <span class="title class_">Public</span></span><br><span class="line"><span class="title class_">Destinations</span> : <span class="number">13</span> <span class="title class_">Routes</span> : <span class="number">13</span></span><br><span class="line"><span class="title class_">Destination</span>/<span class="title class_">Mask</span> <span class="title class_">Proto</span> <span class="title class_">Pre</span> <span class="title class_">Cost</span> <span class="title class_">Flags</span> <span class="title class_">NextHop</span> <span class="title class_">Interface</span></span><br><span class="line"><span class="comment">//路由表中已经有了 10.1.1.0/24、 20.1.1.0/24、 30.1.1.0/24 的路由条目，并且都是路由器 R1 的直连路由， 类似于路由器上的直连物理接口。</span></span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.1</span></span><br><span class="line">...</span><br><span class="line"><span class="number">20.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">20.1</span><span class="number">.1</span><span class="number">.254</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.2</span></span><br><span class="line">...</span><br><span class="line"><span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">30.1</span><span class="number">.1</span><span class="number">.254</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1.3</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在PC1上分别测试与网关地址10.1.1.254和PC2之间的连通性。结果是都能通信。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 PC-1 上 Tracert PC-2。</span></span><br><span class="line"><span class="variable constant_">PC</span>&gt;tracert <span class="number">20.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">traceroute to <span class="number">20.1</span><span class="number">.1</span><span class="number">.1</span>, <span class="number">8</span> hops max</span><br><span class="line">(<span class="variable constant_">ICMP</span>), press <span class="title class_">Ctrl</span>+C to stop</span><br><span class="line"><span class="number">1</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> <span class="number">62</span> ms <span class="number">47</span> ms <span class="number">31</span> ms</span><br><span class="line"><span class="number">2</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">125</span> ms <span class="number">94</span> ms <span class="number">94</span> ms</span><br></pre></td></tr></table></figure>

<p>​		可以观察到，PC-1先把ping包发送给自身的网关10.1.1.254，然后再由网关发送到PC-2。<br>​		现以 PC-1 ping PC-2 为例，分析单臂路由的整个运作过程。<br>两台 PC 由于处于不同的网络中，这时 PC-1 会将数据包发往自己的网关，即路由器 R1的子接口 GE 0&#x2F;0&#x2F;1.1 的地址 10.1.1.254。数据包到达路由器 R1 后，由于路由器的子接口 GE 0&#x2F;0&#x2F;1.1 已经配置了 VLAN 封装，当接收到 PC-1 发送的 VLAN 10 的数据帧时，发现数据帧的 VLAN ID 跟自身 GE 0&#x2F;0&#x2F;1&#x2F;1 接口配置的 VLAN ID 一样，便会剥离掉数据帧的 VLAN 标签后后通过三层路由转发。通过查找路由表后，发现数据包中的目的地址 20.1.1.1 所属的 20.1.1.0&#x2F;24 网段的路由条目，已经是路由器 R1 上的直连路由，且出接口为 GE 0&#x2F;0&#x2F;1.2，便将该数据包发送至 GE 0&#x2F;0&#x2F;1.2接口。当 GE 0&#x2F;0&#x2F;1.2 接口接收到一个没有带 VLAN 标签的数据帧时，便会加上自身接口所配置的 VLAN ID 20 后再进行转发，然后通过交换机将数据帧顺利转发给 PC-2。<br>​		以上便是通过配置单臂路由实现不同 VLAN 间的路由的整个过程。  </p>
<h2 id="常用操作："><a href="#常用操作：" class="headerlink" title="常用操作："></a>常用操作：</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//以下操作都在交换机进行</span></span><br><span class="line">vlan <span class="number">20</span>	<span class="comment">//创建vlan</span></span><br><span class="line">vlan batch	<span class="comment">//批量创建vlan</span></span><br><span class="line">port link-type trunk	<span class="comment">//配置接口类型为Trunk</span></span><br><span class="line">port link-type access	<span class="comment">//配置接口类型为Access</span></span><br><span class="line">port trunk allow-pass <span class="number">10</span> <span class="number">20</span></span><br><span class="line">port trunk allow-pass vlan all	<span class="comment">//允许所有或部分vlan通过</span></span><br><span class="line">display vlan	<span class="comment">//检查VLAN配置情况</span></span><br><span class="line">display port vlan	<span class="comment">//检查VLAN、Trunk和接口配置情况</span></span><br><span class="line">[<span class="variable constant_">S1</span>-vlan10]description [描述]	<span class="comment">//标记命令</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//以下操作均在路由器下进行</span></span><br><span class="line">display ip interface brief	<span class="comment">//查看路由器接口状态</span></span><br><span class="line">display ip routing-table	<span class="comment">//查看路由表</span></span><br></pre></td></tr></table></figure>

<h1 id="4、生成树"><a href="#4、生成树" class="headerlink" title="4、生成树"></a>4、生成树</h1><h2 id="4-1、STP配置和选路规则"><a href="#4-1、STP配置和选路规则" class="headerlink" title="4.1、STP配置和选路规则"></a>4.1、STP配置和选路规则</h2><p>生成树协议 Spanning Tree Protocol</p>
<p><strong>原理概述</strong></p>
<p>​		STP 是用来避免数据链路层出现逻辑环路的协议。使用 BPDU 传递网络信息计算出一根无环的树状网络结构，并阻塞特定端口。在网络出现故障的时候， STP 能快速发现链路故障，并尽快的找出另外一条路径用来进行数据传输。  </p>
<p>​		交换机上运行的 STP 通过 BPDU 信息的交互，选举根交换机，然后每台非根交换机选择用来与根交换机通信的根端口，之后每个网段选择用来转发数据至根交换机的指定端口，最后剩余端口则被阻塞。  </p>
<p>​		在 STP 工作过程中，根交换机的选举，根端口、指定端口的选举都非常重要。华为 VRP提供了各种命令，用来调整 STP 的参数，用以优化网络。例如，交换机优先级、端口优先级、端口代价值等等。  </p>
<h3 id="拓扑及设备信息：-6"><a href="#拓扑及设备信息：-6" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>​		公司购置了 4 台交换机，组建网络。考虑到网络的可靠性，将四台交换机如拓扑图搭建。由于默认情况下，交换机之间运行 STP 后，根交换机、根端口、指定端口的选择将基于交换机的 MAC 地址的大小，带来了不确定性，极可能由此产生隐患。<br>​		公司网络规划，需要 <u>S1 作为主根交换机， S2 作为 S1 的备份根交换机</u>。同时<u>对于 S4交换机， E 0&#x2F;0&#x2F;1 接口应该作为根端口</u>。<u>对于 S2 和 S3 之间的链路，应该保证 S2 的 E 0&#x2F;0&#x2F;3接口作为指定端口</u>。同时在交换机 S3 上，存在两个接口 E 0&#x2F;0&#x2F;10－ 11 连接到测试 PC，测试PC 经常上下线网络，需要<u>将交换机 S3 与之相连的对应端口定义为边缘端口，避免测试电脑上下线对网络产生的影响</u>。  </p>
<p><img src="https://img-blog.csdnimg.cn/c9e5f43c72004193b744344011e11e29.png" alt="请添加图片描述"></p>
<h3 id="1、基本配置"><a href="#1、基本配置" class="headerlink" title="1、基本配置"></a>1、基本配置</h3><p>根据实验拓扑图，在交换机上启用 STP(华为交换机默认启用 MSTP)，将交换机的 STP模式更改为普通生成树 STP。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//有一丢丢不严谨，四个交换机都这么配置就行</span></span><br><span class="line">[<span class="variable constant_">S1</span> <span class="variable constant_">S2</span> <span class="variable constant_">S3</span> <span class="variable constant_">S4</span>]stp enable</span><br><span class="line">[<span class="variable constant_">S1</span> <span class="variable constant_">S2</span> <span class="variable constant_">S3</span> <span class="variable constant_">S4</span>]stp mode stp</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，缺省情况下需要等待 30s 生成树重新计算时间（ 15s Forward Delay 加 15sLearning 状态时间），使用命令 display stp 查看 S1 的生成树状态。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display stp</span><br><span class="line">-------[<span class="variable constant_">CIST</span> <span class="title class_">Global</span> <span class="title class_">Info</span>][<span class="title class_">Mode</span> <span class="variable constant_">STP</span>]-------</span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Bridge</span> :<span class="number">32768.</span>4c1f-cceb-beac</span><br><span class="line">……</span><br><span class="line"><span class="title class_">Last</span> <span class="variable constant_">TC</span> occurred :<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">----[<span class="title class_">Port1</span>(<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>)][<span class="variable constant_">FORWARDING</span>]----</span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Protocol</span> :<span class="title class_">Enabled</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Role</span> :<span class="title class_">Root</span> <span class="title class_">Port</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Priority</span> :<span class="number">128</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Cost</span>(<span class="title class_">Dot1T</span> ) :<span class="title class_">Config</span>=auto / <span class="title class_">Active</span>=<span class="number">1</span></span><br><span class="line"><span class="title class_">Designated</span> <span class="title class_">Bridge</span>/<span class="title class_">Port</span> :<span class="number">32768.</span>4c1f-ccbf-cbb5 / <span class="number">128.1</span></span><br><span class="line">……</span><br><span class="line"><span class="variable constant_">BPDU</span> <span class="title class_">Received</span> :<span class="number">50</span></span><br><span class="line"><span class="attr">TCN</span>: <span class="number">0</span>, <span class="title class_">Config</span>: <span class="number">50</span>, <span class="attr">RST</span>: <span class="number">0</span>, <span class="attr">MST</span>: <span class="number">0</span></span><br><span class="line">----[<span class="title class_">Port2</span>(<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>)][<span class="variable constant_">DISCARDING</span>]----</span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Protocol</span> :<span class="title class_">Enabled</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Role</span> :<span class="title class_">Alternate</span> <span class="title class_">Port</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Priority</span> :<span class="number">128</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Cost</span>(<span class="title class_">Dot1T</span> ) :<span class="title class_">Config</span>=auto / <span class="title class_">Active</span>=<span class="number">1</span></span><br><span class="line"><span class="title class_">Designated</span> <span class="title class_">Bridge</span>/<span class="title class_">Port</span> :<span class="number">32768.</span>4c1f-cceb-658f / <span class="number">128.2</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到 S1 的 E 0/0/1 端口为转发状态、端口角色为根端口， E 0/0/2 端口为丢弃状态，端口角色 Alternate，即替代端口。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 display stp brief 在 S2， S3， S4 上仅查看摘要信息。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在交换机 S2 上面所有的端口为转发状态，观察到 E0/0/1 和 E0/0/3 端口角色为指定端口，E0/0/2 为根端口</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在交换机 S3 上 E 0/0/3 端口角色为 Alternate 端口，且状态为丢弃状态，该端口将不会转发数据流量</span></span><br><span class="line">[<span class="variable constant_">S3</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">ALTE</span> <span class="variable constant_">DISCARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="comment">//在交换机 S4 上所有的端口角色都为指定端口，且端口状态都为转发。</span></span><br><span class="line">[<span class="variable constant_">S4</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初步判断四台交换机中 S4 为根交换机，因为该交换机所有端口都为指定端口。通过命令 display stp 查看生成树详细信息</span></span><br><span class="line">[<span class="variable constant_">S4</span>]display stp</span><br><span class="line">-------[<span class="variable constant_">CIST</span> <span class="title class_">Global</span> <span class="title class_">Info</span>][<span class="title class_">Mode</span> <span class="variable constant_">STP</span>]-------</span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Bridge</span> :<span class="number">32768.</span>4c1f-ccac-<span class="number">3733</span></span><br><span class="line"><span class="title class_">Config</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line"><span class="title class_">Active</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Root</span>/<span class="variable constant_">ERPC</span> :<span class="number">32768.</span>4c1f-ccac-<span class="number">3733</span> / <span class="number">0</span></span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">RegRoot</span>/<span class="variable constant_">IRPC</span> :<span class="number">32768.</span>4c1f-ccac-<span class="number">3733</span> / <span class="number">0</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到“CIST Root”和“CIST Bridge”相同，即目前根交换机 ID 与自身的交换机ID 相同，说明目前 S4 为根交换机。</span></span><br></pre></td></tr></table></figure>

<p>​		生成树运算第一步就是通过比较每台交换机的交换机 ID 选举根交换机，交换机 ID 由交换机优先级和 MAC 地址组成。首先比较交换机优先级，数值最低的为根交换机，如果优先级一样，则比较 MAC 地址，同样数值最低的选举为根交换机。<br>​		目前在该公司的二层拓扑中，四台交换机的生成树都刚刚开始运行，交换机优先级都为默认值，即都相同，故根据每台交换机的 MAC 地址来选举，通过比较，最终 S4 为根交换机。  </p>
<h3 id="2、配置网络中的根交换机"><a href="#2、配置网络中的根交换机" class="headerlink" title="2、配置网络中的根交换机"></a>2、配置网络中的根交换机</h3><p>​		根交换机的在网络当中的位置是非常重要的，如果选择了一台性能较差的交换机，或者是部署在接入层的交换机作为根交换机，会影响到整个网络的通信质量及数据传输。所以确定根交换机的位置极为重要，根交换机选举依据是根交换机 ID（优先级与 MAC 地址组成），值越小越优先，交换机默认的优先级为 32768，当然该值是可以修改的。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//现在将 S1 配置为主根交换机， S2 为备份根交换机，将 S1 的优先级改为 0， S2 的优先级改为 4096。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]stp priority <span class="number">0</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]stp priority <span class="number">4096</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后查看 S1 和 S2 的 STP 状态信息。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display stp</span><br><span class="line">-------[<span class="variable constant_">CIST</span> <span class="title class_">Global</span> <span class="title class_">Info</span>][<span class="title class_">Mode</span> <span class="variable constant_">STP</span>]-------</span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Bridge</span> :<span class="number">0</span> .4c1f-cceb-beac</span><br><span class="line"><span class="title class_">Config</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line"><span class="title class_">Active</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Root</span>/<span class="variable constant_">ERPC</span> :<span class="number">0</span> .4c1f-cceb-beac / <span class="number">0</span></span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">RegRoot</span>/<span class="variable constant_">IRPC</span> :<span class="number">0</span> .4c1f-cceb-beac / <span class="number">0</span></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp</span><br><span class="line">-------[<span class="variable constant_">CIST</span> <span class="title class_">Global</span> <span class="title class_">Info</span>][<span class="title class_">Mode</span> <span class="variable constant_">STP</span>]-------</span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Bridge</span> :<span class="number">4096</span> .4c1f-ccbf-cbb5</span><br><span class="line"><span class="title class_">Config</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line"><span class="title class_">Active</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Root</span>/<span class="variable constant_">ERPC</span> :<span class="number">0</span> .4c1f-cceb-beac / <span class="number">1</span></span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">RegRoot</span>/<span class="variable constant_">IRPC</span> :<span class="number">4096</span> .4c1f-ccbf-cbb5 / <span class="number">0</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//通过观察发现 S1 的优先级变为了 0，为根交换机，而 S2 的优先级变为了 4096，为备份根交换机。</span></span><br></pre></td></tr></table></figure>

<p>也可以使用另外一种方式配置主根交换机和备份根交换机。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//删除在 S1 上所配置的优先级，使用命令 stp root primary 配置主根交换机。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]undo stp priority</span><br><span class="line">[<span class="variable constant_">S1</span>]stp root primary</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除在 S2 上所配置的优先级，使用命令 stp root secondary 配置备份根交换机。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]undo stp priority</span><br><span class="line">[<span class="variable constant_">S2</span>]stp root secondary</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后查看 STP 的状态信息。——结果与第一种方法一样，此处不展示了</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>到这里配置部分就结束了，需要的功能都已经基本实现，之后3、4的部分是理解STP原理以及端口选举的详细设置，不需要的话可跳过。</p>
</blockquote>
<h3 id="3、理解根端口的选举"><a href="#3、理解根端口的选举" class="headerlink" title="3、理解根端口的选举"></a>3、理解根端口的选举</h3><p>​		生成树在选举出根交换机之后，将在每台非根交换机上选举根端口。选举时首先比较该交换机上每个端口到达根交换机的根路径开销，路径开销最小的端口将成为根端口。如果根路径开销值相同，则比较每个端口所在链路上的上行交换机的交换机 ID，如果该交换机 ID也相同，则比较每个端口所在链路上的上行端口的端口 ID。每台交换机上只能拥有一个根端口。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据上一步骤，目前 S1 为主根交换机，而 S2 为备份根交换机，查看 S4 上生成树信息。</span></span><br><span class="line">[<span class="variable constant_">S4</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ALTE</span> <span class="variable constant_">DISCARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="comment">//可以观察到，现在 S4 的 E 0/0/2 为根端口，状态为转发状态。这是由于在 S4 选举根端口时，首先比较根路径开销，由于拓扑中所有链路都是相同的百兆以太网链路， S4 经过 S3到 S1 与经过 S2 到 S1 的开销值相同，接下来比较 S4 的两台上行链路的交换机 S2 和 S3 的交换机标识， S2 目前的交换机优先级为 4096，而 S3 为默认的 32768，所以与 S2 连接 S4的 E0/0/2 接口被选为根端口。  </span></span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查看 S4 的 E 0/0/2 接口开销值。</span></span><br><span class="line">&lt;<span class="variable constant_">S4</span>&gt;display stp interface <span class="title class_">Ethernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">----[<span class="title class_">Port2</span>(<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>)][<span class="variable constant_">FORWARDING</span>]----</span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Protocol</span> :<span class="title class_">Enabled</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Role</span> :<span class="title class_">Root</span> <span class="title class_">Port</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Priority</span> :<span class="number">128</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Cost</span>(<span class="title class_">Dot1T</span> ) :<span class="title class_">Config</span>=auto / <span class="title class_">Active</span>=<span class="number">1</span></span><br><span class="line"><span class="title class_">Designated</span> <span class="title class_">Bridge</span>/<span class="title class_">Port</span> :<span class="number">4096.</span>4c1f-ccbf-cbb5 / <span class="number">128.2</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到，接口路径开销采用的是 Dot1t 的计算方法， Config 是指手工配置的路径开销， Active 是实际使用的路径开销，开销值为 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置 S4 的 E 0/0/2 接口的代价值为 2000，即增加该接口默认的代价值。</span></span><br><span class="line">[<span class="variable constant_">S4</span>]interface ethernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S4</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>]stp cost <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后再次查看 S4 的 E 0/0/2 接口开销值以及 STP 状态摘要信息。</span></span><br><span class="line">&lt;<span class="variable constant_">S4</span>&gt;display stp interface <span class="title class_">Ethernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">----[<span class="title class_">Port2</span>(<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>)][<span class="variable constant_">DISCARDING</span>]----</span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Protocol</span> :<span class="title class_">Enabled</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Role</span> :<span class="title class_">Alternate</span> <span class="title class_">Port</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Priority</span> :<span class="number">128</span></span><br><span class="line"><span class="title class_">Port</span> <span class="title class_">Cost</span>(<span class="title class_">Dot1T</span> ) :<span class="title class_">Config</span>=<span class="number">2000</span> / <span class="title class_">Active</span>=<span class="number">2000</span></span><br><span class="line"><span class="title class_">Designated</span> <span class="title class_">Bridge</span>/<span class="title class_">Port</span> :<span class="number">4096.</span>4c1f-ccbf-cbb5 / <span class="number">128.2</span></span><br><span class="line">……</span><br><span class="line">[<span class="variable constant_">S4</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">ALTE</span> <span class="variable constant_">DISCARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//发现此时 E 0/0/1 端口角色变成了根端口，而 E 0/0/2 变成了 Alternate 端口。这是由于将 E 0/0/2 接口的开销修改为 2000 之后，在选举根端口时，其到根路径开销大于 E 0/0/1 的根路径开销。</span></span><br></pre></td></tr></table></figure>

<h3 id="4、理解指定端口的选举"><a href="#4、理解指定端口的选举" class="headerlink" title="4、理解指定端口的选举"></a>4、理解指定端口的选举</h3><p>​		生成树协议在每台非根交换机选举出根端口之后，将在每个网段上选举指定端口，选举的比较规则和选举根端口类似。</p>
<p>​		现在网络管理员需要确保 S2 连接 S3 的 E 0&#x2F;0&#x2F;3 接口被选择为指定端口，可以通过修改端口开销值来实现。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//为了模拟该场景，将 S2 的优先级恢复为默认的 32768。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]undo stp root</span><br><span class="line"><span class="comment">//配置完成后，查看 S2 的 STP 状态信息。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp</span><br><span class="line">-------[<span class="variable constant_">CIST</span> <span class="title class_">Global</span> <span class="title class_">Info</span>][<span class="title class_">Mode</span> <span class="variable constant_">STP</span>]-------</span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Bridge</span> :<span class="number">32768.</span>4c1f-ccfa-a769</span><br><span class="line"><span class="title class_">Config</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//S2 的优先级已经变成了 32768</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//查看 S2 与 S3 的 STP 状态摘要信息。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">ALTE</span> <span class="variable constant_">DISCARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line">[<span class="variable constant_">S3</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">10</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">11</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="comment">//通过观察发现在 S2 与 S3 间的链路上，选择了 S3 的 E 0/0/3 接口为指定端口，而 S2 的E 0/0/3 接口为 Alternate 端口。这是由于在选举指定端口时，首先比较两个端口的根路径开销，目前都相同，接着比较上行交换机的交换机 ID，此时 S2 和 S3 的交换机优先级相同，故比较 MAC 地址，最后通过比较 MAC 地址得出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//查看 S2 和 S3 的 E 0/0/3 接口信息。</span></span><br><span class="line">&lt;<span class="variable constant_">S2</span>&gt;display interface <span class="title class_">Ethernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> current state : <span class="variable constant_">UP</span></span><br><span class="line">……</span><br><span class="line"><span class="title class_">Current</span> system <span class="attr">time</span>: <span class="number">2013</span>-<span class="number">08</span>-<span class="number">30</span> <span class="number">13</span>:<span class="number">48</span>:<span class="number">06</span>-<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="title class_">Hardware</span> address is 4c1f-ccbf-cbb5</span><br><span class="line"><span class="title class_">Last</span> <span class="number">300</span> seconds input rate <span class="number">0</span> bytes/sec, <span class="number">0</span> packets/sec</span><br><span class="line">……</span><br><span class="line">&lt;<span class="variable constant_">S3</span>&gt;display interface <span class="title class_">Ethernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> current state : <span class="variable constant_">UP</span></span><br><span class="line">……</span><br><span class="line"><span class="title class_">Current</span> system <span class="attr">time</span>: <span class="number">2013</span>-<span class="number">08</span>-<span class="number">30</span> <span class="number">13</span>:<span class="number">49</span>:<span class="number">15</span>-<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="title class_">Hardware</span> address is 4c1f-cc00-58df</span><br><span class="line"><span class="title class_">Last</span> <span class="number">300</span> seconds input rate <span class="number">0</span> bytes/sec, <span class="number">0</span> packets/sec</span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到， S2 上 E 0/0/3 接口的 MAC 地址大于 S3 上 E0/0/3 接口的 MAC 地址，所以该网段上 S3 的 E0/0/3 接口成为指定接口。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改 S3 的 E 0/0/2 接口的开销值，将该值增大（默认为 1），即增大该端口上的根路径开销，确保让 S2 的 E 0/0/3 接口成为指定端口</span></span><br><span class="line">[<span class="variable constant_">S3</span>]interface <span class="title class_">Ethernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S3</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span>]stp cost <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后查看 S2 的 STP 状态摘要信息。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="comment">//根据 STP 计算规则选择指定端口时，最终选择 S2 的 E0/0/3 接口作为指定端口。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//为了验证现在能够确保S2的E0/0/3接口能成为指定端口，将S3的优先级调整为4096，并查看。</span></span><br><span class="line">[<span class="variable constant_">S3</span>]stp priority <span class="number">4096</span></span><br><span class="line">[<span class="variable constant_">S3</span>]display stp</span><br><span class="line">-------[<span class="variable constant_">CIST</span> <span class="title class_">Global</span> <span class="title class_">Info</span>][<span class="title class_">Mode</span> <span class="variable constant_">STP</span>]-------</span><br><span class="line"><span class="variable constant_">CIST</span> <span class="title class_">Bridge</span> :<span class="number">4096</span> .4c1f-cc00-58df</span><br><span class="line"><span class="title class_">Config</span> <span class="title class_">Times</span> :<span class="title class_">Hello</span> 2s <span class="title class_">MaxAge</span> 20s <span class="title class_">FwDly</span> 15s <span class="title class_">MaxHop</span> <span class="number">20</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//配置完成后观察到 S3 的优先级已调整为 4096。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//再次查看 S2 和 S3 的 STP 状态。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line">[<span class="variable constant_">S3</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">ALTE</span> <span class="variable constant_">DISCARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//通过观察，即使修改了 S3 的优先级，目前比 S2 的优先级值更低，但是 S2 的 E 0/0/3接口仍然为指定端口，而 S3 的 E 0/0/3 接口还是 Alternate 端口。验证了在选举指定端口时首先比较根路径开销的规则。</span></span><br></pre></td></tr></table></figure>

<p><strong>在选举指定端口时首先比较根路径开销</strong></p>
<blockquote>
<p>RSTP和MSTP在STP的基础上进行了改进，本次项目暂时不需要新增的功能，因此跳过这一部分。</p>
</blockquote>
<h1 id="5、其他交换技术"><a href="#5、其他交换技术" class="headerlink" title="5、其他交换技术"></a>5、其他交换技术</h1><h2 id="5-1、Eth-Trunk链路交换技术"><a href="#5-1、Eth-Trunk链路交换技术" class="headerlink" title="5.1、Eth-Trunk链路交换技术"></a>5.1、Eth-Trunk链路交换技术</h2><p><strong>原理概述：</strong></p>
<p>​		在没有使用 Eth-Trunk 前，百兆以太网的双绞线在两个互连的网络设备间的带宽仅为100Mbit&#x2F;s。若想达到更高的数据传输速率，则需要更换传输媒介，使用千兆光纤或升级成为千兆以太网。这样的解决方案成本较高。如果采用 Eth-Trunk 技术把多个接口捆绑在一起，则可以以较低的成本满足提高接口带宽的需求。例如，把 3 个 100Mbit&#x2F;s 的全双工接口捆绑在一起，就可以达到 300Mbit&#x2F;s 的最大带宽。</p>
<p>​		Eth-Trunk 是一种捆绑技术，它将多个物理接口捆绑成一个逻辑接口，这个逻辑接口就称为 Eth-Trunk 接口，捆绑在一起的每个物理接口称为成员接口。 Eth-Trunk 只能由以太网链路构成。 Trunk 的优势在于：</p>
<p>​		负载分担， 在一个 Eth-Trunk 接口内，可以实现流量负载分担；</p>
<p>​		提高可靠性， 当某个成员接口连接的物理链路出现故障时，流量会切换到其他可用的链路上，从而提高整个 Trunk 链路的可靠性；</p>
<p>​		增加带宽，Trunk 接口的总带宽是各成员接口带宽之和。</p>
<p>​		Eth-Trunk 在逻辑上把多条物理链路捆绑等同于一条逻辑链路，对上层数据透明传输。所有 Eth-Trunk 中物理接口的参数必须一致， Eth-Trunk 链路两端要求一致的物理参数有：<strong>Eth-Trunk 链路两端相连的物理接口类型、物理接口数量、 物理接口的速率、 物理接口的双工方式以及物理接口的流控方式</strong>  </p>
<p>###拓扑及设备信息：</p>
<p>本实验模拟企业网络环境， S1 和 S2 为企业核心交换机， PC-1 属于 A 部门终端设备，PC-2 属于 B 部门终端设备。 根据企业规划， S1 和 S2 之间线路原由 1 条光纤线路相连，但是由于带宽和冗余角度考虑需要对其进行升级， 需要使用 Eth-Trunk 实现此需求。  </p>
<p><img src="https://img-blog.csdnimg.cn/4e7e1884ecc446cc82bb1d9152b2a6aa.png" alt="请添加图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/75ca076d9135417eadf915d38f958c19.png" alt="请添加图片描述"></p>
<h3 id="1、基本配置-1"><a href="#1、基本配置-1" class="headerlink" title="1、基本配置"></a>1、基本配置</h3><p>检测连通性，此处省略</p>
<p>由于本实验场景需要，请首先将 S1 与 S2 上互连的 GE 0&#x2F;0&#x2F;2 和 GE 0&#x2F;0&#x2F;5 接口关闭。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]shutdown</span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span>]shutdown</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]shutdown</span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span>]shutdown</span><br></pre></td></tr></table></figure>

<h3 id="2、未配置Eth-Trunk时的现象验证"><a href="#2、未配置Eth-Trunk时的现象验证" class="headerlink" title="2、未配置Eth-Trunk时的现象验证"></a>2、未配置Eth-Trunk时的现象验证</h3><p>通过增加链路的方式来提升带宽。在原有的网络基础上再增加一条链路来提高带宽，原链路只有一条，带宽为 1Gb&#x2F;s，再增加一条链路，将带宽增加到 2Gb&#x2F;s。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//模拟链路增加，开启 S1 和 S2 上的 GE 0/0/2 接口。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo shutdown</span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment">//增加链路后，在该组网拓扑下，默认开启的 STP 协议一定会将其中一条链路阻塞掉</span></span><br><span class="line"><span class="comment">//查看 S1 和 S2 的 STP 状态信息。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display stp brief</span><br><span class="line"><span class="variable constant_">MSTID</span> <span class="title class_">Port</span> <span class="title class_">Role</span> <span class="variable constant_">STP</span> <span class="title class_">State</span> <span class="title class_">Protection</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="variable constant_">ROOT</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="variable constant_">ALTE</span> <span class="variable constant_">DISCARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="number">0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">3</span> <span class="variable constant_">DESI</span> <span class="variable constant_">FORWARDING</span> <span class="variable constant_">NONE</span></span><br><span class="line"><span class="comment">//可以观察到 S2 的 GE 0/0/2 接口处于丢弃状态。如果要实质性的增加 S1 和 S2 之间的带宽，显然单靠增加链路条数是不够的。 生成树会阻塞多余接口， 使得目前 S1 与 S2 之间的数据仍然仅通过 GE 0/0/1 接口传输。</span></span><br></pre></td></tr></table></figure>

<h3 id="3、配置Eth-Trunk实现链路聚合（手工负载分担模式）"><a href="#3、配置Eth-Trunk实现链路聚合（手工负载分担模式）" class="headerlink" title="3、配置Eth-Trunk实现链路聚合（手工负载分担模式）"></a>3、配置Eth-Trunk实现链路聚合（手工负载分担模式）</h3><p>​		通过上一步骤，发现仅靠简单增加互联的链路，不但无法解决目前带宽不够用的问题，还会再切换时带来断网的问题，显然是不合理的。此时通过配置 Eth-Trunk 链路聚合来增加链路带宽，并可确保冗余链路被使用。</p>
<p><strong>Eth-Trunk 工作模式可以分为两种：</strong></p>
<ul>
<li>手工负载分担模式：需要手动创建链路聚合组，并配置多个接口加入到所创建的Eth-trunk 中。</li>
<li>静态 LACP 模式：该模式通过 LACP 协议协商 Eth-trunk 参数后并自主选择活动接口。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 S1 和 S2 上配置链路聚合，创建 Eth-Trunk 1 接口，并指定为手工负载分担模式。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]mode manual load-balance</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]mode manual load-balance</span><br><span class="line"></span><br><span class="line"><span class="comment">//将 S1 和 S2 的 GE 0/0/1 和 GE 0/0/2 分别加入到 Eth-Trunk 1 接口。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]eth-trunk <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]eth-trunk <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后， 使用 display eth-trunk 命令查看 S1 和 S2 的 Eth-Trunk 1 接口状态。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display eth-trunk <span class="number">1</span></span><br><span class="line"><span class="title class_">Eth</span>-<span class="title class_">Trunk1</span><span class="string">&#x27;s state information is:</span></span><br><span class="line"><span class="string">WorkingMode: NORMAL Hash arithmetic: According to SIP-XOR-DIP</span></span><br><span class="line"><span class="string">Least Active-linknumber: 1 Max Bandwidth-affected-linknumber: 8</span></span><br><span class="line"><span class="string">Operate status: up Number Of Up Port In Trunk: 2</span></span><br><span class="line"><span class="string">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">PortName Status Weight</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/1 Up 1</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/2 Up 1</span></span><br><span class="line"><span class="string">[S2]display eth-trunk 1</span></span><br><span class="line"><span class="string">Eth-Trunk1&#x27;</span>s state information <span class="attr">is</span>:</span><br><span class="line"><span class="title class_">WorkingMode</span>: <span class="variable constant_">NORMAL</span> <span class="title class_">Hash</span> <span class="attr">arithmetic</span>: <span class="title class_">According</span> to <span class="variable constant_">SIP</span>-<span class="variable constant_">XOR</span>-<span class="variable constant_">DIP</span></span><br><span class="line"><span class="title class_">Least</span> <span class="title class_">Active</span>-<span class="attr">linknumber</span>: <span class="number">1</span> <span class="title class_">Max</span> <span class="title class_">Bandwidth</span>-affected-<span class="attr">linknumber</span>: <span class="number">8</span></span><br><span class="line"><span class="title class_">Operate</span> <span class="attr">status</span>: up <span class="title class_">Number</span> <span class="title class_">Of</span> <span class="title class_">Up</span> <span class="title class_">Port</span> <span class="title class_">In</span> <span class="title class_">Trunk</span>: <span class="number">2</span></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">PortName</span> <span class="title class_">Status</span> <span class="title class_">Weight</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="title class_">Up</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="title class_">Up</span> <span class="number">1</span></span><br><span class="line"><span class="comment">//可以观察到，S1与S2的工作模式为NORMAL（手工负载分担方式），GE 0/0/1与GE 0/0/2接口已经添加到 Eth-Trunk 1 中，并且处于 UP 状态。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 display interface eth-trunk 命令查看 S2 的 Eth-Trunk 1 接口信息。</span></span><br><span class="line">[<span class="variable constant_">S2</span>]display interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">Eth</span>-<span class="title class_">Trunk1</span> current state : <span class="variable constant_">UP</span></span><br><span class="line"><span class="title class_">Line</span> protocol current state : <span class="variable constant_">UP</span></span><br><span class="line"><span class="title class_">Description</span>:</span><br><span class="line"><span class="title class_">Switch</span> <span class="title class_">Port</span>, <span class="variable constant_">PVID</span> : <span class="number">1</span>, <span class="title class_">Hash</span> arithmetic : <span class="title class_">According</span> to <span class="variable constant_">SIP</span>-<span class="variable constant_">XOR</span>-<span class="variable constant_">DIP</span>,<span class="title class_">Maximal</span> <span class="attr">BW</span>:</span><br><span class="line"><span class="number">4294967.</span>29G, <span class="title class_">Current</span> <span class="attr">BW</span>: <span class="number">4294967.</span>29G, <span class="title class_">The</span> <span class="title class_">Maximum</span> <span class="title class_">Frame</span> <span class="title class_">Length</span> is <span class="number">9216</span></span><br><span class="line"><span class="variable constant_">IP</span> <span class="title class_">Sending</span> <span class="title class_">Frames</span><span class="string">&#x27; Format is PKTFMT_ETHNT_2, Hardware address is 4c1f-cc71-68d4</span></span><br><span class="line"><span class="string">Current system time: 2013-06-29 22:34:26-08:00</span></span><br><span class="line"><span class="string">Input bandwidth utilization : 0%</span></span><br><span class="line"><span class="string">Output bandwidth utilization : 0%</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="string">PortName Status Weight</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/1 UP 1</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/2 UP 1</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="string">The Number of Ports in Trunk : 2</span></span><br><span class="line"><span class="string">The Number of UP Ports in Trunk : 2</span></span><br><span class="line"><span class="string">//可以观察到，目前该接口的总带宽，是 GE 0/0/1 和 GE 0/0/2 接口带宽之和:Maximal BW:</span></span><br><span class="line"><span class="string">4294967.29G</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//查看 S2 接口的生成树状态。</span></span><br><span class="line"><span class="string">[S2]display stp brief</span></span><br><span class="line"><span class="string">MSTID Port Role STP State Protection</span></span><br><span class="line"><span class="string">0 GigabitEthernet0/0/3 DESI FORWARDING NONE</span></span><br><span class="line"><span class="string">0 Eth-Trunk1 ROOT FORWARDING NONE</span></span><br><span class="line"><span class="string">//可以观察到， S2 的 2 个接口被捆绑成一个 Eth-Trunk 接口，并且该接口现在处于转发状态。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//使用 ping 命令持续测试，同时将 S2 的 GE 0/0/1 或者 GE 0/0/2 接口关闭模拟故障发生。</span></span><br><span class="line"><span class="string">PC&gt;ping 10.0.1.2 -t</span></span><br><span class="line"><span class="string">Ping 10.0.1.2: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=1 ttl=128 time=63 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=2 ttl=128 time=31 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=3 ttl=128 time=31 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=4 ttl=128 time=16 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=5 ttl=128 time=31 ms</span></span><br><span class="line"><span class="string">Request timeout!</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=7 ttl=128 time=47 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=8 ttl=128 time=15 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=9 ttl=128 time=31 ms</span></span><br><span class="line"><span class="string">From 10.0.1.2: bytes=32 seq=10 ttl=128 time=16 ms</span></span><br><span class="line"><span class="string">//可以观察到，当链路故障发生时，链路立刻进行切换，数据包仅丢了一个，并且只要物理链路有一条是正常的， Eth-Trunk 接口就不会断开，仍然可以保证数据的转发。 Eth-Trunk在提高了带宽的情况下，也实现了链路冗余。 模拟完成后将 S2 接口恢复。</span></span><br></pre></td></tr></table></figure>

<h3 id="4、配置Eth-Trunk实现链路聚合（静态LACP模式）"><a href="#4、配置Eth-Trunk实现链路聚合（静态LACP模式）" class="headerlink" title="4、配置Eth-Trunk实现链路聚合（静态LACP模式）"></a>4、配置Eth-Trunk实现链路聚合（静态LACP模式）</h3><pre><code>    在上一步骤中，两条链路中，假设一条链路出现了故障，只有一条链路正常工作的情况
</code></pre>
<p>下无法保证带宽。现在再部署一条链路作为备份链路，并采用静态 LACP模式配置 Eth-Trunk 实现两条链路同时转发，一条链路备份，当其中一条转发链路出现问题的时候，备份链路可立即进行数据转发 。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//开启 S1 与 S2 上的 GE 0/0/5 接口模拟增加了一条新链路。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span>]undo shutdown</span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span>]undo shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment">//在 S1 和 S2 上的 Eth-Trunk 1 接口下，将工作模式改为静态 LACP 模式。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]mode lacp-<span class="keyword">static</span></span><br><span class="line"><span class="title class_">Error</span>: <span class="title class_">Error</span> <span class="keyword">in</span> changing trunk working mode. <span class="title class_">There</span> <span class="title function_">is</span>(are) <span class="title function_">port</span>(s) <span class="keyword">in</span> the trunk.</span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]mode lacp-<span class="keyword">static</span></span><br><span class="line"><span class="title class_">Error</span>: <span class="title class_">Error</span> <span class="keyword">in</span> changing trunk working mode. <span class="title class_">There</span> <span class="title function_">is</span>(are) <span class="title function_">port</span>(s) <span class="keyword">in</span> the trunk.</span><br><span class="line"></span><br><span class="line"><span class="comment">//发现报错，此时需要将先前已经加入到 Eth-Trunk 接口下的物理接口先删除。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo eth-trunk <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]undo eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]undo eth-trunk <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除完成后，再在 S1 和 S2 上的 Eth-Trunk 1 接口下，将工作模式改为静态 LACP 模式，并将 S1 和 S2 的 GE 0/0/1， GE 0/0/2 和 GE 0/0/5 接口分别加入到 Eth-Trunk 1 接口。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]mode lacp-<span class="keyword">static</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span>]eth-trunk <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">S2</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]mode lacp-<span class="keyword">static</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]eth-trunk <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">[<span class="variable constant_">S2</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span>]eth-trunk <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，查看 S1 的 Eth-Trunk 1 接口状态。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display eth-trunk <span class="number">1</span></span><br><span class="line"><span class="title class_">Eth</span>-<span class="title class_">Trunk1</span><span class="string">&#x27;s state information is:</span></span><br><span class="line"><span class="string">Local:</span></span><br><span class="line"><span class="string">LAG ID: 1 WorkingMode: STATIC</span></span><br><span class="line"><span class="string">Preempt Delay: Disabled Hash arithmetic: According to SIP-XOR-DIP</span></span><br><span class="line"><span class="string">System Priority: 32768 System ID: 4c1f-cc55-b90f</span></span><br><span class="line"><span class="string">Least Active-linknumber: 1 Max Active-linknumber: 8</span></span><br><span class="line"><span class="string">Operate status: up Number Of Up Port In Trunk: 3</span></span><br><span class="line"><span class="string">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">//可以观察到，三个接口默认都处于活动状态（ Selected）。</span></span><br><span class="line"><span class="string">ActorPortName Status PortType PortPri PortNo PortKey PortState Weight</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/2 Selected 1000TG 32768 3 401 10111100 1</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/1 Selected 1000TG 32768 2 401 10111100 1</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/5 Selected 1000TG 32768 6 401 10111100 1</span></span><br><span class="line"><span class="string">Partner:</span></span><br><span class="line"><span class="string">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">ActorPortName SysPri SystemID PortPri PortNo PortKey PortState</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/2 32768 4c1f-cc71-68d4 32768 3 401 10111100</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/1 32768 4c1f-cc71-68d4 32768 2 401 10111100</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/5 32768 4c1f-cc71-68d4 32768 6 401 10111100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//将 S1 的系统优先级从默认的 32768 改为 100，使其成为主动端（值越低优先级越高）。按照主动端设备的接口来选择活动接口。 两端设备选出主动端后， 两端都会以主动端的接口优先级来选择活动接口。两端设备选择了一致的活动接口，活动链路组便可以建立起来，从这些活动链路中以负载分担的方式转发数据。</span></span><br><span class="line"><span class="string">[S1]lacp priority 100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//配置完成后，查看 S1 的 Eth-Trunk 1 接口状态。</span></span><br><span class="line"><span class="string">[S1]display eth-trunk 1</span></span><br><span class="line"><span class="string">Eth-Trunk1&#x27;</span>s state information <span class="attr">is</span>:</span><br><span class="line"><span class="title class_">Local</span>:</span><br><span class="line"><span class="variable constant_">LAG</span> <span class="attr">ID</span>: <span class="number">1</span> <span class="title class_">WorkingMode</span>: <span class="variable constant_">STATIC</span></span><br><span class="line"><span class="title class_">Preempt</span> <span class="title class_">Delay</span>: <span class="title class_">Disabled</span> <span class="title class_">Hash</span> <span class="attr">arithmetic</span>: <span class="title class_">According</span> to <span class="variable constant_">SIP</span>-<span class="variable constant_">XOR</span>-<span class="variable constant_">DIP</span></span><br><span class="line"><span class="title class_">System</span> <span class="title class_">Priority</span>: <span class="number">100</span> <span class="title class_">System</span> <span class="attr">ID</span>: 4c1f-cc55-b90f</span><br><span class="line"><span class="title class_">Least</span> <span class="title class_">Active</span>-<span class="attr">linknumber</span>: <span class="number">1</span> <span class="title class_">Max</span> <span class="title class_">Active</span>-<span class="attr">linknumber</span>: <span class="number">8</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到，已经将 S1 的 LACP 系统优先级改为 100，而 S2 没修改，仍为默认值。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在 S1 上配置活动接口上限阈值为 2。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">Eth</span>-<span class="title class_">Trunk</span> <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">Eth</span>-<span class="title class_">Trunk1</span>]max active-linknumber <span class="number">2</span></span><br><span class="line"><span class="comment">//在 S1 上配置接口的优先级确定活动链路。</span></span><br><span class="line"><span class="comment">//配置接口的活动优先级将默认的 32768 改为 100，目的是为了使得 GE 0/0/1 和 GE 0/0/2接口成为活动状态。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]lacp priority <span class="number">100</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="variable constant_">S1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span>]lacp priority <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，查看 S1 的 Eth-Trunk 1 接口状态。</span></span><br><span class="line">[<span class="variable constant_">S1</span>]display eth-trunk <span class="number">1</span></span><br><span class="line"><span class="title class_">Eth</span>-<span class="title class_">Trunk1</span><span class="string">&#x27;s state information is:</span></span><br><span class="line"><span class="string">Local:</span></span><br><span class="line"><span class="string">LAG ID: 1 WorkingMode: STATIC</span></span><br><span class="line"><span class="string">Preempt Delay: Disabled Hash arithmetic: According to SIP-XOR-DIP</span></span><br><span class="line"><span class="string">System Priority: 100 System ID: 4c1f-cc55-b90f</span></span><br><span class="line"><span class="string">Least Active-linknumber: 1 Max Active-linknumber: 2</span></span><br><span class="line"><span class="string">Operate status: up Number Of Up Port In Trunk: 2</span></span><br><span class="line"><span class="string">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">ActorPortName Status PortType PortPri PortNo PortKey PortState Weight</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/2 Selected 1000TG 100 3 401 10111100 1</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/1 Selected 1000TG 100 2 401 10111100 1</span></span><br><span class="line"><span class="string">GigabitEthernet0/0/5 Unselect 1000TG 32768 6 401 10100000 1</span></span><br><span class="line"><span class="string">Partner:</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="string">//可以观察到，由于将接口的阈值改为 2（默认活动接口最大阈值为 8），该 Eth-Trunk 接口下将只有两个成员处于活动状态，并且具有负载分担能力。而 GE 0/0/5 接口已处于不活动状态（ Unselect），该链路作为备份链路。当活动链路出现故障时，备份链路将会替代故障链路，保持数据传输的可靠性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//将 S1 的 GE 0/0/1 接口关闭，验证 Eth-Trunk 链路聚合信息。</span></span><br><span class="line"><span class="string">[S1]interface GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="string">[S1-GigabitEthernet0/0/1]shutdown</span></span><br><span class="line"><span class="string">[S1-GigabitEthernet0/0/1]display eth-trunk 1</span></span><br><span class="line"><span class="string">Eth-Trunk1&#x27;</span>s state information <span class="attr">is</span>:</span><br><span class="line"><span class="title class_">Local</span>:</span><br><span class="line"><span class="variable constant_">LAG</span> <span class="attr">ID</span>: <span class="number">1</span> <span class="title class_">WorkingMode</span>: <span class="variable constant_">STATIC</span></span><br><span class="line"><span class="title class_">Preempt</span> <span class="title class_">Delay</span>: <span class="title class_">Disabled</span> <span class="title class_">Hash</span> <span class="attr">arithmetic</span>: <span class="title class_">According</span> to <span class="variable constant_">SIP</span>-<span class="variable constant_">XOR</span>-<span class="variable constant_">DIP</span></span><br><span class="line"><span class="title class_">System</span> <span class="title class_">Priority</span>: <span class="number">100</span> <span class="title class_">System</span> <span class="attr">ID</span>: 4c1f-cc27-e139</span><br><span class="line"><span class="title class_">Least</span> <span class="title class_">Active</span>-<span class="attr">linknumber</span>: <span class="number">1</span> <span class="title class_">Max</span> <span class="title class_">Active</span>-<span class="attr">linknumber</span>: <span class="number">2</span></span><br><span class="line"><span class="title class_">Operate</span> <span class="attr">status</span>: up <span class="title class_">Number</span> <span class="title class_">Of</span> <span class="title class_">Up</span> <span class="title class_">Port</span> <span class="title class_">In</span> <span class="title class_">Trunk</span>: <span class="number">2</span></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">ActorPortName</span> <span class="title class_">Status</span> <span class="title class_">PortType</span> <span class="title class_">PortPri</span> <span class="title class_">PortNo</span> <span class="title class_">PortKey</span> <span class="title class_">PortState</span> <span class="title class_">Weight</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="title class_">Unselect</span> 1GE <span class="number">100</span> <span class="number">2</span> <span class="number">305</span> <span class="number">10100010</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span> <span class="title class_">Selected</span> 1GE <span class="number">100</span> <span class="number">3</span> <span class="number">305</span> <span class="number">10111100</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span> <span class="title class_">Selected</span> 1GE <span class="number">32768</span> <span class="number">6</span> <span class="number">305</span> <span class="number">10111100</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">Partner</span>:</span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到， S1 的 GE 0/0/1 接口已经处于不活动状态，而 GE 0/0/5 接口为活动状态。将 S1 的 GE 0/0/1 接口开启后，又会恢复为活动状态，GE 0/0/5 则为不活动状态，现象省略。</span></span><br></pre></td></tr></table></figure>

<p>至此，完成了整个 Eth-Trunk 的部署。  </p>
<h1 id="6、OSPF"><a href="#6、OSPF" class="headerlink" title="6、OSPF"></a>6、OSPF</h1><p>开放式最短路径优先（Open Shortest Path First，OSPF）是广泛使用的一种动态路由协议，它属于链路状态路由协议，具有路由变化收敛速度快、无路由环路、支持变长子网掩码（VLSM）和汇总、层次区域划分等优点。</p>
<h2 id="6-1、OSPF单区域设置"><a href="#6-1、OSPF单区域设置" class="headerlink" title="6.1、OSPF单区域设置"></a>6.1、OSPF单区域设置</h2><p><strong>原理概述：</strong></p>
<p>​		OSPF 作为基于链路状态的协议，具有收敛快、路由无环、 扩展性好等优点， 被快速接受并广泛使用。 链路状态算法路由协议互相通告的是链路状态信息，每台路由器都将自己的链路状态信息（包含接口的 IP 地址和子网掩码、 网络类型、 该链路的开销等）发送给其他路由器， 并在网络中泛洪， 当每台路由器收集到网络内所有链路状态信息后，就能拥有整个网络的拓扑情况，然后根据整网拓扑情况运行 SPF 算法，得出到所有网段的最短路径。  </p>
<p>​		OSPF 支持区域的划分， 区域是从逻辑上将路由器划分为不同的组，每个组用区域号（ Area ID）来标识。一个网段（链路）只能属于一个区域，或者说每个运行 OSPF 的接口必须指明属于哪一个区域。 区域 0 为骨干区域，骨干区域负责在非骨干区域之间发布区域间的路由信息， 在一个 OSPF 区域中只能有一个骨干区域。  </p>
<h3 id="拓扑及设备信息：-7"><a href="#拓扑及设备信息：-7" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>本实验模拟企业网络场景，该公司有三大办公区，每个办公区放置了一台路由器， R1<br>放在办公区 A， A 区经理的 PC-1 直接连接 R1； R2 放在办公区 B， B 区经理的 PC-2 直接连<br>接到 R2； R3 放在办公区 C， C 区经理的 PC-3 直接连接到 R3；三台路由器都互相直连，为<br>了能使整个公司网络互相通信，需要在所有路由器上部署路由协议，考虑到公司未来的发展<br>（部门的增加和分公司的成立）， 为了适应不断扩展的网络的需求，公司在所有路由器上部<br>署 OSPF 协议，且现在所有路由器都属于骨干区域。  </p>
<p><img src="https://img-blog.csdnimg.cn/e76f99f341b44bc784a55b461d69d969.png" alt="请添加图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/f1b140333d0a430c8ae23b35f5d1c4f6.png" alt="请添加图片描述"></p>
<h3 id="1、部署单区域OSPF网络"><a href="#1、部署单区域OSPF网络" class="headerlink" title="1、部署单区域OSPF网络"></a>1、部署单区域OSPF网络</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//首先使用命令 ospf 创建并运行 OSPF。</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;system-view</span><br><span class="line">[<span class="variable constant_">R1</span>]ospf <span class="number">1</span></span><br><span class="line"><span class="comment">//1代表的是进程号，如果没有写明进程号，默认是 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//接着使用命令 area 创建区域并进入 OSPF 区域视图， 输入要创建的区域 ID。由于本实验为 OSPF 单区域配置，所以使用骨干区域，即区域 0 即可。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//再使用 network 命令来指定运行 OSPF 协议的接口和接口所属的区域。本实验中 R1 上的三个物理接口都需要指定。配置中需注意， 尽量精确匹配所通告的网段</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.10</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.20</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后使用命令 display ospf interface 检查 OSPF 接口通告是否正确。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]display ospf interface</span><br><span class="line"><span class="variable constant_">OSPF</span> <span class="title class_">Process</span> <span class="number">1</span> <span class="keyword">with</span> <span class="title class_">Router</span>-<span class="variable constant_">ID</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">		<span class="title class_">Interfaces</span></span><br><span class="line"><span class="title class_">Area</span>: <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> (<span class="variable constant_">MPLS</span> <span class="variable constant_">TE</span> not enabled)</span><br><span class="line"><span class="variable constant_">IP</span> <span class="title class_">Address</span> <span class="title class_">Type</span> <span class="title class_">State</span> <span class="title class_">Cost</span> <span class="title class_">Pri</span> <span class="variable constant_">DR</span> <span class="variable constant_">BDR</span></span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span> <span class="title class_">Broadcast</span> <span class="variable constant_">DR</span> <span class="number">1</span> <span class="number">1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="number">172.16</span><span class="number">.10</span><span class="number">.1</span> <span class="title class_">Broadcast</span> <span class="variable constant_">DR</span> <span class="number">1</span> <span class="number">1</span> <span class="number">172.16</span><span class="number">.10</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="number">172.16</span><span class="number">.20</span><span class="number">.1</span> <span class="title class_">Broadcast</span> <span class="variable constant_">DR</span> <span class="number">1</span> <span class="number">1</span> <span class="number">172.16</span><span class="number">.20</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment">//可以观察到本地 OSPF 进程使用的 Router-ID 是 172.16.1.254。 在此进程下， 有三个接口加入了 OSPF 进程。 网络类型为以太网默认的广播网络类型。 State 为该接口当前的状态，显示为 DR 状态，即表示为这三个接口在它们所在的网段中都被选举为 DR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在 R2 和 R3 上做相应配置，配置方法和 R1 相同，不再赘述</span></span><br><span class="line">&lt;<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>&gt;system-view</span><br><span class="line">[<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.10</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.30</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br></pre></td></tr></table></figure>

<h3 id="2、检查OSPF单区域的配置结果"><a href="#2、检查OSPF单区域的配置结果" class="headerlink" title="2、检查OSPF单区域的配置结果"></a>2、检查OSPF单区域的配置结果</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//以 R1 为例使用 display ospf peer 命令查看 OSPF 邻居状态。</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;display ospf peer</span><br><span class="line"><span class="variable constant_">OSPF</span> <span class="title class_">Process</span> <span class="number">1</span> <span class="keyword">with</span> <span class="title class_">Router</span>-<span class="variable constant_">ID</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">		<span class="title class_">Neighbors</span></span><br><span class="line"><span class="title class_">Area</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> interface <span class="number">172.16</span><span class="number">.10</span><span class="number">.1</span>(<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>)<span class="string">&#x27;s neighbors</span></span><br><span class="line"><span class="string">Router-ID: 172.16.2.254 Address: 172.16.10.2</span></span><br><span class="line"><span class="string">State: Full Mode:Nbr is Master Priority: 1</span></span><br><span class="line"><span class="string">DR: 172.16.10.1 BDR: 172.16.10.2 MTU: 0</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">		Neighbors</span></span><br><span class="line"><span class="string">Area 0.0.0.0 interface 172.16.20.1(GigabitEthernet0/0/1)&#x27;</span>s neighbors</span><br><span class="line"><span class="title class_">Router</span>-<span class="attr">ID</span>: <span class="number">172.16</span><span class="number">.3</span><span class="number">.254</span> <span class="title class_">Address</span>: <span class="number">172.16</span><span class="number">.20</span><span class="number">.3</span></span><br><span class="line"><span class="title class_">State</span>: <span class="title class_">Full</span> <span class="title class_">Mode</span>:<span class="title class_">Nbr</span> is <span class="title class_">Master</span> <span class="title class_">Priority</span>: <span class="number">1</span></span><br><span class="line"><span class="attr">DR</span>: <span class="number">172.16</span><span class="number">.20</span><span class="number">.1</span> <span class="attr">BDR</span>: <span class="number">172.16</span><span class="number">.20</span><span class="number">.3</span> <span class="attr">MTU</span>: <span class="number">0</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//通过 Router-ID 可以查看邻居的路由器标识</span></span><br><span class="line"><span class="comment">//通过 Address 可以查看邻居的 OSPF 接口 IP 地址</span></span><br><span class="line"><span class="comment">//通过 State 可以查看目前与该路由器的OSPF 邻居状态</span></span><br><span class="line"><span class="comment">//通过 Priority 可以查看当前该邻居 OSPF 接口的 DR 优先级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 display ip routing-table protocol ospf 命令查看 R1 上的 OSPF 路由表</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;display ip routing-table protocol ospf</span><br><span class="line"><span class="title class_">Route</span> <span class="title class_">Flags</span>: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Public</span> routing table : <span class="variable constant_">OSPF</span></span><br><span class="line"><span class="title class_">Destinations</span> : <span class="number">3</span> <span class="title class_">Routes</span> : <span class="number">4</span></span><br><span class="line"><span class="variable constant_">OSPF</span> routing table status : &lt;<span class="title class_">Active</span>&gt;</span><br><span class="line"><span class="title class_">Destinations</span> : <span class="number">3</span> <span class="title class_">Routes</span> : <span class="number">4</span></span><br><span class="line"><span class="title class_">Destination</span>/<span class="title class_">Mask</span> <span class="title class_">Proto</span> <span class="title class_">Pre</span> <span class="title class_">Cost</span> <span class="title class_">Flags</span> <span class="title class_">NextHop</span> <span class="title class_">Interface</span></span><br><span class="line"><span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span>/<span class="number">24</span> <span class="variable constant_">OSPF</span> <span class="number">10</span> <span class="number">2</span> D <span class="number">172.16</span><span class="number">.10</span><span class="number">.2</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="number">172.16</span><span class="number">.3</span><span class="number">.0</span>/<span class="number">24</span> <span class="variable constant_">OSPF</span> <span class="number">10</span> <span class="number">2</span> D <span class="number">172.16</span><span class="number">.20</span><span class="number">.3</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="number">172.16</span><span class="number">.30</span><span class="number">.0</span>/<span class="number">24</span> <span class="variable constant_">OSPF</span> <span class="number">10</span> <span class="number">2</span> D <span class="number">172.16</span><span class="number">.10</span><span class="number">.2</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="variable constant_">OSPF</span> <span class="number">10</span> <span class="number">2</span> D <span class="number">172.16</span><span class="number">.20</span><span class="number">.3</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="variable constant_">OSPF</span> routing table status : &lt;<span class="title class_">Inactive</span>&gt;</span><br><span class="line"><span class="title class_">Destinations</span> : <span class="number">0</span> <span class="title class_">Routes</span> : <span class="number">0</span></span><br><span class="line"><span class="comment">//“Destination/Mask” 标识了目的网段的前缀及掩码</span></span><br><span class="line"><span class="comment">//“Proto”标识了此路由信息是通过 OSPF 协议获取到的</span></span><br><span class="line"><span class="comment">//“Pre” 标识了路由优先级</span></span><br><span class="line"><span class="comment">//“Cost” 标识了开销值</span></span><br><span class="line"><span class="comment">//“NextHop” 标识了下一跳地址</span></span><br><span class="line"><span class="comment">//“Interface” 标识了此前缀的出接口</span></span><br></pre></td></tr></table></figure>

<p>此时 R1 的路由表中已经拥有了去往网络中所有其他网段的路由条目。 R2 与 R3 上的现<br>象一样，此处不再赘述。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在PC-1上用ping命令测试与PC-3间的连通性</span></span><br><span class="line"><span class="variable constant_">PC</span>&gt;ping <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line"><span class="title class_">Ping</span> <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span>: <span class="number">32</span> data bytes, <span class="title class_">Press</span> <span class="title class_">Ctrl</span>_C to <span class="keyword">break</span></span><br><span class="line"><span class="title class_">From</span> <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span>: bytes=<span class="number">32</span> seq=<span class="number">1</span> ttl=<span class="number">126</span> time=<span class="number">31</span> ms</span><br><span class="line"><span class="title class_">From</span> <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span>: bytes=<span class="number">32</span> seq=<span class="number">2</span> ttl=<span class="number">126</span> time=<span class="number">32</span> ms</span><br><span class="line"><span class="title class_">From</span> <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span>: bytes=<span class="number">32</span> seq=<span class="number">3</span> ttl=<span class="number">126</span> time=<span class="number">15</span> ms</span><br><span class="line"><span class="title class_">From</span> <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span>: bytes=<span class="number">32</span> seq=<span class="number">4</span> ttl=<span class="number">126</span> time=<span class="number">16</span> ms</span><br><span class="line"><span class="title class_">From</span> <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span>: bytes=<span class="number">32</span> seq=<span class="number">5</span> ttl=<span class="number">126</span> time=<span class="number">16</span> ms</span><br><span class="line">--- <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span> ping statistics ---</span><br><span class="line"><span class="number">5</span> <span class="title function_">packet</span>(s) transmitted</span><br><span class="line"><span class="number">5</span> <span class="title function_">packet</span>(s) received</span><br><span class="line"><span class="number">0.00</span>% packet loss</span><br><span class="line">round-trip min/avg/max = <span class="number">15</span>/<span class="number">22</span>/<span class="number">32</span> ms</span><br><span class="line"><span class="comment">//通信正常，其他测试省略</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>OSPF 多区域配置等功能本项目暂时不使用，此处省略 </p>
</blockquote>
<h3 id="6-2、使用OSPF默认路由"><a href="#6-2、使用OSPF默认路由" class="headerlink" title="6.2、使用OSPF默认路由"></a>6.2、使用OSPF默认路由</h3><p><strong>原理概述：</strong></p>
<p>​		默认路由是指目的地址和掩码都是 0 的路由条目。当路由器无精确匹配的路由时，就可以通过默认路由进行报文转发。 如果报文的目的地址不在路由表的默认路由中，那么该报文将被路由器丢弃，并向源端返回一个 ICMP 报文，报告该目的地址或网络不可达。</p>
<p>​		合理使用默认路由，可以很大程度减小本地路由表的大小，节约设备资源。 默认路由可以在路由器上手工配置，也可以由路由协议自动发布。  </p>
<blockquote>
<p>此处参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45728716/article/details/104433800">https://blog.csdn.net/weixin_45728716/article/details/104433800</a></p>
</blockquote>
<h3 id="1、OSPF下放默认路由的方法"><a href="#1、OSPF下放默认路由的方法" class="headerlink" title="1、OSPF下放默认路由的方法"></a>1、OSPF下放默认路由的方法</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">default-route-advise always</span><br></pre></td></tr></table></figure>

<h3 id="2、OSPF下放默认路由的方法"><a href="#2、OSPF下放默认路由的方法" class="headerlink" title="2、OSPF下放默认路由的方法"></a>2、OSPF下放默认路由的方法</h3><p><strong>在出口路由器R1中下放默认路由：</strong></p>
<p>如图，在内网运行ospf，现在访问ISP上的一个地址8.8.8.8，R1作为出口路由器配置了一条默认路由。R1可以正常访问8.8.8.8。</p>
<p><img src="https://img-blog.csdnimg.cn/20200224092002741.png?x-oss-process=image"></p>
<p>R1可以正常访问8.8.8.8，但是R2、R3是没有去8.8.8.8的路由的，所以此时需要在R1上下放默认路由。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">R1</span>]ospf</span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>]<span class="keyword">default</span>-route-advertise</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看R2、R3的路由表是否收到默认路由</span></span><br><span class="line">[<span class="variable constant_">R2</span> <span class="variable constant_">R3</span>]dis ip rout</span><br><span class="line">...</span><br><span class="line"><span class="title class_">Destination</span>/<span class="title class_">Mask</span>  <span class="title class_">Proto</span>  <span class="title class_">Pre</span>  <span class="title class_">Cost</span>  <span class="title class_">Flags</span>  <span class="title class_">NextHop</span>  <span class="title class_">Interface</span></span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span>         <span class="variable constant_">O_ASE</span>  <span class="number">150</span>    <span class="number">1</span>     D    <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="title class_">Gig</span>...</span><br><span class="line">...</span><br><span class="line">[<span class="variable constant_">R3</span>]dis ip routing-table</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="7、VRRP"><a href="#7、VRRP" class="headerlink" title="7、VRRP"></a>7、VRRP</h1><p>虚拟路由冗余协议（Virtual Router Redundancy Protocol，简称VRRP）是由IETF提出的解决局域网中配置静态网关出现单点失效现象的路由协议，1998年已推出正式的RFC2338协议标准。VRRP广泛应用在边缘网络中，它的设计目标是支持特定情况下IP数据流量失败转移不会引起混乱，允许主机使用单路由器，以及即使在实际第一跳路由器使用失败的情形下仍能够维护路由器间的连通性。</p>
<h2 id="7-1、VRRP基本配置"><a href="#7-1、VRRP基本配置" class="headerlink" title="7.1、VRRP基本配置"></a>7.1、VRRP基本配置</h2><p><strong>原理概述：</strong></p>
<p>​		随着 Internet 的发展，人们对网络可靠性的要求越来越高。对于用户来说，能够时刻与外部网络保持通信非常重要，但内部网络中的所有主机通常只能设置一个网关 IP 地址，通过该出口网关实现主机与外部网络的通信。若此时出口网关设备发生故障，主机与外部网络的通信就会中断， 所以配置多个出口网关是提高网络可靠性的常用方法。 为此 IETF 组织推出了 VRRP 协议， 使得在多个出口网关的情况下主机仅需配置一个虚拟网关 IP 地址作为出口网关即可， 解决了局域网主机访问外部网络的可靠性问题。  </p>
<p>​		VRRP（ Virtual Router Redundancy Protocol）全称是虚拟路由冗余协议， 它是一种容错协议。该协议通过把几台路由设备联合组成一台虚拟的路由设备， 该虚拟路由器在本地局域网拥有唯一的一个虚拟 ID 和虚拟 IP 地址。实际上该虚拟路由器是由一个 Master 设备和若干 Backup 设备组成。正常情况下，业务全部由 Master 承担，所有客户端仅需设置此虚拟 IP为网关地址。当 Master 出现故障时， Backup 接替工作，及时将业务切换到备份路由器，从而保持通讯的连续性和可靠性。 而客户端无需做任何配置更改，对故障无感知。</p>
<p>​		VRRP 的 Master 选举基于优先级，优先级取值范围是 0－ 255，缺省情况下，配置优先级为 100，在接口上可以配置优先级的大小来手工选择 Master 设备。  </p>
<h3 id="拓扑及设备信息：-8"><a href="#拓扑及设备信息：-8" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>​		本实验模拟企业网络场景，公司内员工如 PC-1、 PC-2 通过交换机 LSW1 连接到公司网络， LSW1 连接到公司出口网关路由器。 为了提高网络的可靠性，公司使用两台路由器 R2与 R3 作为双出口连接到外网路由器 R1。 R1、 R2、 R3 之间运行 OSPF 协议。在双网关的情况下，如果在 PC 上配置 R2 或 R3 的真实 IP 地址作为网关，当其中一台路由器故障时，就需要手动更改 PC 的网关 IP，若网络中有大量 PC 则需要耗费大量时间和人力去更改配置，且会带来一定时间的断网影响。 为了能够使故障所造成的断网影响达到最小化， 增强网络的可靠性，网络管理员在 R2 与 R3 之间部署 VRRP 协议，可以使得当任一网关发生故障时能自动切换而无需更改 PC 的网关 IP 地址。</p>
<p><img src="https://img-blog.csdnimg.cn/4280fefecab8427f815d75f2c6c4999b.png" alt="请添加图片描述"></p>
<h3 id="1、部署OSPF网络"><a href="#1、部署OSPF网络" class="headerlink" title="1、部署OSPF网络"></a>1、部署OSPF网络</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在公司的出口网关路由器 R1，R2，和外网路由器 R3 上配置 OSPF 协议，使用进程号 1，且所有网段均通告进区域 0 中。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.3</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">R2</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R2</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R2</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R2</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">R3</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R3</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R3</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R3</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">172.16</span><span class="number">.3</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，在 R1 上检查 OSPF 邻居建立情况。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]display ospf peer brief</span><br><span class="line"><span class="variable constant_">OSPF</span> <span class="title class_">Process</span> <span class="number">1</span> <span class="keyword">with</span> <span class="title class_">Router</span>-<span class="variable constant_">ID</span> <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Peer</span> <span class="title class_">Statistic</span> <span class="title class_">Information</span></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Area</span> <span class="title class_">Id</span> <span class="title class_">Interface</span> <span class="title class_">Neighbor</span> id <span class="title class_">State</span></span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span> <span class="title class_">Full</span></span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.200</span> <span class="title class_">Full</span></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="comment">//可以观察到，此时 R1 已经于 R2， R3 成功建立起了 OSPF 邻居关系。</span></span><br></pre></td></tr></table></figure>

<h3 id="2、配置VRRP协议"><a href="#2、配置VRRP协议" class="headerlink" title="2、配置VRRP协议"></a>2、配置VRRP协议</h3><p>为了提高网络的可靠性，针对两台出口网关路由器实现主备备份。即正常情况下，只有主网关工作，当其发生故障时能够自动切换到备份网关。现在通过配置 VRRP 协议来实现这样的需求。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R2 和 R3 上配置 VRRP 协议， 使用命令 vrrp vrid virtual-ip 创建 VRRP 备份组，指定即R1和R2处于同一个VRRP 备份组内，VRRP 备份组号为 1，配置虚拟 IP 为172.16.1.254。注意虚拟 IP 地址必须和当前接口在同一网段。</span></span><br><span class="line">[<span class="variable constant_">R2</span>]interface ethernet <span class="number">1</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R2</span>-<span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span>]vrrp vrid <span class="number">1</span> virtual-ip <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">R3</span>]interface ethernet <span class="number">1</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R3</span>-<span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span>]vrrp vrid <span class="number">1</span> virtual-ip <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="comment">//经过这样的配置后， PC 将使用虚拟路由器 IP 地址作为默认网关。</span></span><br></pre></td></tr></table></figure>

<p>​		在 VRRP 协议中，优先级决定路由器在备份组中的角色，优先级高者成为 Master。 如果优先级相同，比较接口的 IP 地址大小，较大的成为 Master。优先级值缺省为 100， 0 被系统保留， 255 保留给 IP 地址拥有者使用。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//现在配置R2的优先级为120，R3的优先级保持默认100不变，这将使得R2成为Master，R3 为 Backup。</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">R2</span>-<span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span>]vrrp vrid <span class="number">1</span> priority <span class="number">120</span></span><br><span class="line"><span class="comment">//配置完成后，在 R2 和 R3 上使用 display vrrp 查看 VRRP 信息。</span></span><br><span class="line">[<span class="variable constant_">R2</span>]display vrrp</span><br><span class="line"><span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span> | <span class="title class_">Virtual</span> <span class="title class_">Router</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">State</span> : <span class="title class_">Master</span></span><br><span class="line"><span class="title class_">Virtual</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Master</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="title class_">PriorityRun</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">PriorityConfig</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">MasterPriority</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">Preempt</span> : <span class="variable constant_">YES</span> <span class="title class_">Delay</span> <span class="title class_">Time</span> : <span class="number">0</span> s</span><br><span class="line">……</span><br><span class="line">[<span class="variable constant_">R3</span>]display vrrp</span><br><span class="line"><span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span> | <span class="title class_">Virtual</span> <span class="title class_">Router</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">State</span> : <span class="title class_">Backup</span></span><br><span class="line"><span class="title class_">Virtual</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Master</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="title class_">PriorityRun</span> : <span class="number">100</span></span><br><span class="line"><span class="title class_">PriorityConfig</span> : <span class="number">100</span></span><br><span class="line"><span class="title class_">MasterPriority</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">Preempt</span> : <span class="variable constant_">YES</span> <span class="title class_">Delay</span> <span class="title class_">Time</span> : <span class="number">0</span> s</span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到现在 R2 的 VRRP 状态是 Master，R3 是 Backup。两者都处在 VRRP 备份组1 中，且都是 E 0/0/1 接口运行在 VRRP 协议中。输出信息中的 PriorityRun 表示设备当前的运行优先级，PriorityConfig 表示为该设备配置的优先级，MasterPriority 为该备份组中Master的优先级。</span></span><br><span class="line"><span class="comment">//般配置优先级就是运行优先级，但个别情况下可能运行优先级和配置优先级会不一样</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//也可以使用命令display vrrp brief 或 display vrrp interface来显示VRRP的工作状态，以 R2 为例</span></span><br><span class="line">[<span class="variable constant_">R2</span>]display vrrp brief</span><br><span class="line"><span class="variable constant_">VRID</span> <span class="title class_">State</span> <span class="title class_">Interface</span> <span class="title class_">Type</span> <span class="title class_">Virtual</span> <span class="variable constant_">IP</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"><span class="number">1</span> <span class="title class_">Master</span> <span class="title class_">Eth1</span>/<span class="number">0</span>/<span class="number">1</span> <span class="title class_">Normal</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"><span class="title class_">Total</span>:<span class="number">1</span> <span class="title class_">Master</span>:<span class="number">1</span> <span class="title class_">Backup</span>:<span class="number">0</span> <span class="title class_">Non</span>-<span class="attr">active</span>:<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[<span class="variable constant_">R2</span>]display vrrp interface ethernet1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span> | <span class="title class_">Virtual</span> <span class="title class_">Router</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">State</span> : <span class="title class_">Master</span></span><br><span class="line"><span class="title class_">Virtual</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Master</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="title class_">PriorityRun</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">PriorityConfig</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">MasterPriority</span> : <span class="number">120</span></span><br><span class="line"><span class="title class_">Preempt</span> : <span class="variable constant_">YES</span> <span class="title class_">Delay</span> <span class="title class_">Time</span> : <span class="number">0</span> s</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//测试 PC 机访问公网时的数据包转发路径。</span></span><br><span class="line"><span class="variable constant_">PC</span>&gt;tracert <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line">traceroute to <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span>, <span class="number">8</span> hops max</span><br><span class="line">(<span class="variable constant_">ICMP</span>), press <span class="title class_">Ctrl</span>+C to stop</span><br><span class="line"><span class="number">1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span> <span class="number">32</span> ms <span class="number">31</span> ms <span class="number">15</span> ms</span><br><span class="line"><span class="number">2</span> <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span> <span class="number">63</span> ms <span class="number">62</span> ms <span class="number">47</span> ms</span><br><span class="line"><span class="comment">//可以观察此时都是通过 R2 转发。</span></span><br></pre></td></tr></table></figure>

<h3 id="3、验证VRRP主备切换"><a href="#3、验证VRRP主备切换" class="headerlink" title="3、验证VRRP主备切换"></a>3、验证VRRP主备切换</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//现在手动模拟网络出现故障，将 LSW1 的 E 0/0/1 接口关闭。</span></span><br><span class="line">[<span class="title class_">LSW1</span>]interface ethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="title class_">LSW1</span>-<span class="title class_">Ethernet0</span>/<span class="number">0</span>/<span class="number">1</span>]shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment">//经过 3 秒钟左右后， 使用 display vrrp 查看 R3 的 VRRP 信息。</span></span><br><span class="line">[<span class="variable constant_">R3</span>]display vrrp</span><br><span class="line"><span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span> | <span class="title class_">Virtual</span> <span class="title class_">Router</span> <span class="number">1</span></span><br><span class="line"><span class="title class_">State</span> : <span class="title class_">Master</span></span><br><span class="line"><span class="title class_">Virtual</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Master</span> <span class="variable constant_">IP</span> : <span class="number">172.16</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line"><span class="title class_">PriorityRun</span> : <span class="number">100</span></span><br><span class="line"><span class="title class_">PriorityConfig</span> : <span class="number">100</span></span><br><span class="line"><span class="title class_">MasterPriority</span> : <span class="number">100</span></span><br><span class="line"><span class="title class_">Preempt</span> : <span class="variable constant_">YES</span> <span class="title class_">Delay</span> <span class="title class_">Time</span> : <span class="number">0</span> s</span><br><span class="line">……</span><br><span class="line"><span class="comment">//可以观察到 R3 切换成为了 Master，从而能够确保用户对公网的访问，几乎感知不到故障的发生。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试 PC 机访问公网时的数据包转发路径。</span></span><br><span class="line"><span class="variable constant_">PC</span>&gt;tracert <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line">traceroute to <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span>, <span class="number">8</span> hops max</span><br><span class="line">(<span class="variable constant_">ICMP</span>), press <span class="title class_">Ctrl</span>+C to stop</span><br><span class="line"><span class="number">1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.200</span> <span class="number">63</span> ms <span class="number">15</span> ms <span class="number">32</span> ms</span><br><span class="line"><span class="number">2</span> <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span> <span class="number">62</span> ms <span class="number">62</span> ms <span class="number">32</span> ms</span><br><span class="line"><span class="comment">//发现数据包发送路径已经切换到 R3。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果 R2 从故障中恢复，手动开启 LSW1 的 E 0/0/1 接口。</span></span><br><span class="line">[<span class="title class_">LWS1</span>]interface ethernet <span class="number">1</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="title class_">LSW1</span>-<span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span>]undo shutdown</span><br><span class="line"><span class="comment">//查看 R2 和 R3 的 VRRP 工作状态。</span></span><br><span class="line">[<span class="variable constant_">R2</span>]display vrrp brief</span><br><span class="line"><span class="title class_">Total</span>:<span class="number">1</span> <span class="title class_">Master</span>:<span class="number">1</span> <span class="title class_">Backup</span>:<span class="number">0</span> <span class="title class_">Non</span>-<span class="attr">active</span>:<span class="number">0</span></span><br><span class="line"><span class="variable constant_">VRID</span> <span class="title class_">State</span> <span class="title class_">Interface</span> <span class="title class_">Type</span> <span class="title class_">Virtual</span> <span class="variable constant_">IP</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"><span class="number">1</span> <span class="title class_">Master</span> <span class="title class_">Eth1</span>/<span class="number">0</span>/<span class="number">1</span> <span class="title class_">Normal</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">[<span class="variable constant_">R3</span>]display vrrp brief</span><br><span class="line"><span class="title class_">Total</span>:<span class="number">1</span> <span class="title class_">Master</span>:<span class="number">1</span> <span class="title class_">Backup</span>:<span class="number">0</span> <span class="title class_">Non</span>-<span class="attr">active</span>:<span class="number">0</span></span><br><span class="line"><span class="variable constant_">VRID</span> <span class="title class_">State</span> <span class="title class_">Interface</span> <span class="title class_">Type</span> <span class="title class_">Virtual</span> <span class="variable constant_">IP</span></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"><span class="number">1</span> <span class="title class_">Backup</span> <span class="title class_">Eth1</span>/<span class="number">0</span>/<span class="number">1</span> <span class="title class_">Normal</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="comment">//可以观察到 Master 设备又立刻重新切换回至 R2。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//测试 PC 机访问公网时的数据包转发路径。</span></span><br><span class="line"><span class="variable constant_">PC</span>&gt;tracert <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line">traceroute to <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span>, <span class="number">8</span> hops max</span><br><span class="line">(<span class="variable constant_">ICMP</span>), press <span class="title class_">Ctrl</span>+C to stop</span><br><span class="line"><span class="number">1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span> <span class="number">47</span> ms <span class="number">47</span> ms <span class="number">46</span> ms</span><br><span class="line"><span class="number">2</span> <span class="number">172.16</span><span class="number">.2</span><span class="number">.254</span> <span class="number">78</span> ms <span class="number">78</span> ms <span class="number">62</span> ms</span><br><span class="line"><span class="comment">//可以验证也切换回 R2 转发。而这整个过程对于用户来说是透明的。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>VRRP多备份组等功能暂时不需要，此处略过。感兴趣可查看官方文档</p>
</blockquote>
<h1 id="8、DHCP"><a href="#8、DHCP" class="headerlink" title="8、DHCP"></a>8、DHCP</h1><p>动态主机配置协议（Dynamic Host Configuration Protocol）是一个局域网的网络协议。指的是由服务器控制一段IP地址范围，客户机登录服务器时就可以自动获得服务器分配的IP地址和子网掩码。</p>
<h2 id="8-1、配置基于接口地址池的DHCP"><a href="#8-1、配置基于接口地址池的DHCP" class="headerlink" title="8.1、配置基于接口地址池的DHCP"></a>8.1、配置基于接口地址池的DHCP</h2><p><strong>原理概述：</strong></p>
<p>​		随着网络规模的扩大和网络复杂程度的提高，经常出现计算机位置变化（如便携机或无线网络）和计算机数量超过可分配的 IP 地址的情况。 DHCP（ Dynamic Host Configuration Protocol，动态主机配置协议）就是为满足这些需求而发展起来的。 DHCP 协议采用客户端&#x2F;服务器（ Client&#x2F;Server）方式工作，DHCP Client 向 DHCP Server动态地请求配置信息， DHCP Server 根据策略返回相应的配置信息（如 IP 地址等）。</p>
<p>​		DHCP 客户端首次登录网络时，主要通过四个阶段与 DHCP 服务器建立联系。</p>
<p>​		发现阶段，即 DHCP 客户端寻找 DHCP 服务器的阶段。客户端以广播方式发送DHCP_Discover 报文，只有 DHCP 服务器才会进行响应；</p>
<p>​		提供阶段，即 DHCP 服务器提供 IP 地址的阶段。 DHCP 服务器接收到客户端的DHCP_Discover 报文后，从 IP 地址池中挑选一个尚未分配的 IP 地址分配给客户端，向该客户端发送包含出租 IP 地址和其它设置的 DHCP_Offer 报文；  </p>
<p>​		选择阶段，即 DHCP 客户端选择 IP 地址的阶段。如果有多台 DHCP 服务器向该客户端发来 DHCP_Offer 报文，客户端只接受第一个收到的 DHCP_Offer 报文，然后以广播方式向各 DHCP 服务器回应 DHCP_Request 报文。</p>
<p>​		确认阶段，即 DHCP 服务器确认所提供 IP 地址的阶段。当 DHCP 服务器收到 DHCP 客户端回答的 DHCP_Request 报文后，便向客户端发送包含它所提供的 IP 地址和其它设置的DHCP_ACK 确认报文。</p>
<h3 id="拓扑及设备信息：-9"><a href="#拓扑及设备信息：-9" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>​		本实验将路由器 R1 模拟成为公司 DHCP Server，该公司两个部门市场部和财务部下的PC 通过 DHCP 的方式自动配置 IP 地址。网络管理员配置客户端 PC 通过接口地址池的方式自动获取 IP 地址。  </p>
<p><img src="https://img-blog.csdnimg.cn/eaf73ff96307461699db3e2f44b7ba15.png" alt="请添加图片描述"></p>
<h3 id="1、基本配置-2"><a href="#1、基本配置-2" class="headerlink" title="1、基本配置"></a>1、基本配置</h3><p>​		根据实验编址表进行相应的基本 IP 地址配置，由于 PC 是通过 DHCP 自动获取地址，暂时无法测试连通性。交换机为二层设备，无需配置 IP 地址。  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[R1]interface GigabitEthernet 0/0/0</span><br><span class="line">[R1-GigabitEthernet0/0/0]ip address 192.168.1.254 24</span><br><span class="line">[R1-GigabitEthernet0/0/0]interface GigabitEthernet 0/0/1</span><br><span class="line">[R1-GigabitEthernet0/0/1]ip address 192.168.2.254 24</span><br></pre></td></tr></table></figure>

<h3 id="2、基于接口配置DHCP-Server-功能"><a href="#2、基于接口配置DHCP-Server-功能" class="headerlink" title="2、基于接口配置DHCP Server 功能"></a>2、基于接口配置DHCP Server 功能</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R1 上开启 DHCP 功能。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]dhcp enable</span><br><span class="line"></span><br><span class="line"><span class="comment">//在 R1 的 GE 0/0/0 和 GE 0/0/1 接口，配置命令 dhcp select interface 开启接口的 DHCP服务功能，指定从接口地址池分配地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]dhcp select interface</span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]dhcp select interface</span><br></pre></td></tr></table></figure>

<p>​		接口地址池可动态分配 IP 地址，范围就是接口的 IP 地址所在网段，且只在此接口下有效。当 DHCP 服务器接收到 DHCP 客户端的请求报文后， DHCP 服务器将会使用该接口的地址网段给客户端分配地址。  </p>
<h3 id="3、配置基于接口的DHCP-Server-租期-x2F-DNS-服务器地址"><a href="#3、配置基于接口的DHCP-Server-租期-x2F-DNS-服务器地址" class="headerlink" title="3、配置基于接口的DHCP Server 租期&#x2F;DNS 服务器地址"></a>3、配置基于接口的DHCP Server 租期&#x2F;DNS 服务器地址</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R1 的 GE 0/0/0 接口上使用命令 dhcp server lease 配置 DHCP 服务器接口地址池中 IP地址的租用有效期限为 2 天， GE 0/0/1 接口不修改，使用默认值 1 天，超过租期后该地址将会重新分配。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]dhcp server lease day <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在 GE 0/0/0 接口上使用命令 dhcp server excluded-ip-address 配置接口地址池中不参与自动分配的 IP 地址范围为 192.168.1.1 到 192.168.1.10。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]dhcp server excluded-ip-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>

<p>​		有些地址需要分配给其他的服务，如 DNS 服务器或 HTTP 服务器等需要手工静态配置的 IP 地址，就不能再动态分配给客户端使用，可以执行该命令配置地址池中不参与自动分配的 IP 地址（默认该地址池所有地址参与自动分配，此命令作为可选命令）。</p>
<p>​		当 DHCP 服务器收到客户端的 DHCP 请求时， DPCP 服务器将会选择地址池中空闲的IP 地址分配给客户端。 GE 0&#x2F;0&#x2F;0 接口地址池中 192.168.1.1-192.168.1.10 不参与分配， 而 GE0&#x2F;0&#x2F;1 接口没有配置该命令，因此可以分配的 IP 地址范围 192.168.2.1-192.168.2.253（不包括本接口地址）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 GE 0/0/1 接口上使用命令 dhcp server dns-list 指定接口地址池下的 DNS 服务器，为PC-2 自动分配 DNS 服务器地址为 8.8.8.8</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]dhcp server dns-list <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br></pre></td></tr></table></figure>

<h3 id="4、配置DHCP-Client"><a href="#4、配置DHCP-Client" class="headerlink" title="4、配置DHCP Client"></a>4、配置DHCP Client</h3><p>设置PC使用DHCP配置地址：</p>
<p>打开PC-1的基础配置界面，在IPv4配置栏中选择DHCP，点击右下角“应用”；</p>
<p>选择PC-1中的“命令行”界面，输入命令ipconfig查看接口的IP地址；</p>
<p>通过观察发现PC-1已经通过DHCP Server获取到一个IPv4地址，192.168.1.xxx，网关地址为路由器的接口地址192.168.1.254。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R1 上使用命令 display ip pool 查看 DHCP 地址池当中的地址分配情况。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]display ip pool</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Pool</span>-name : <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="title class_">Pool</span>-<span class="title class_">No</span> : <span class="number">0</span></span><br><span class="line"><span class="title class_">Position</span> : <span class="title class_">Interface</span> <span class="title class_">Status</span> : <span class="title class_">Unlocked</span></span><br><span class="line"><span class="title class_">Gateway</span>-<span class="number">0</span> : <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Mask</span> : <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="variable constant_">VPN</span> instance : --</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Pool</span>-name : <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="title class_">Pool</span>-<span class="title class_">No</span> : <span class="number">1</span></span><br><span class="line"><span class="title class_">Position</span> : <span class="title class_">Interface</span> <span class="title class_">Status</span> : <span class="title class_">Unlocked</span></span><br><span class="line"><span class="title class_">Gateway</span>-<span class="number">0</span> : <span class="number">192.168</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Mask</span> : <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="variable constant_">VPN</span> instance : --</span><br><span class="line"><span class="variable constant_">IP</span> address <span class="title class_">Statistic</span></span><br><span class="line"><span class="title class_">Total</span> :<span class="number">506</span></span><br><span class="line"><span class="title class_">Used</span> :<span class="number">1</span> <span class="title class_">Idle</span> :<span class="number">495</span></span><br><span class="line"><span class="title class_">Expired</span> :<span class="number">0</span> <span class="title class_">Conflict</span> :<span class="number">0</span> <span class="title class_">Disable</span> :<span class="number">10</span></span><br><span class="line"><span class="comment">//通过该命令观察到目前为基于接口的地址池， 由于有两个接口启用 DHCP 功能，所以地址池也有两个， Pool-name 分别为 GE 0/0/0， GE 0/0/1。 在 DHCP Server 地址池中，网关为 192.168.1.254，掩码为 255.255.255.0， IP 地址池总共可以分配 506 个地址（除了路由器接口地址），已经使用了一个，空闲地址为 495 个，其中地址池中有 10 个地址是不参与分配的。</span></span><br></pre></td></tr></table></figure>

<p>PC-2的配置与测试方式与PC-1相同，此处省略。</p>
<h2 id="8-2、配置基于全局地址池的DHCP"><a href="#8-2、配置基于全局地址池的DHCP" class="headerlink" title="8.2、配置基于全局地址池的DHCP"></a>8.2、配置基于全局地址池的DHCP</h2><p><strong>原理概述：</strong></p>
<p>​		基于接口地址池的 DHCP 服务器，连接这个接口网段的用户都从该接口地址池中获取IP 地址等配置信息，由于地址池绑定在特定的接口上，可以限制用户的使用条件，在保障了安全性的同时也存在一定局限性。当用户从不同接口接入 DHCP 服务器且需要从同一个地址池里获取 IP 地址时，就需要配置基于全局地址池的 DHCP。</p>
<p>​		配置基于全局地址池的 DHCP 服务器，从所有接口上连接的用户都可以选择该地址池中的地址， 也就是说全局地址池是一个公共地址池。 在 DHCP 服务器上创建地址池并配置相关属性（ 包括地址范围、地址租期、不参与自动分配的 IP 地址等），在配置接口工作在全局地址池模式。 路由器支持工作在全局地址池模式的接口有三层接口及其子接口、三层Ethernet 接口及其子接口、三层 Eth-trunk 接口及其子接口和 VLANIF 接口。</p>
<h3 id="拓扑及设备信息：-10"><a href="#拓扑及设备信息：-10" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h3><p>​		本实验将路由器 R1 模拟成为公司 DHCP Server， 配置全局地址池， 该公司两个部门市场部和财务部下的 PC 通过 DHCP 的方式自动配置 IP 地址。  </p>
<p><img src="https://img-blog.csdnimg.cn/f9245ce7a86641abb67957806930873f.png" alt="请添加图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/fb8d95fdcd744c3592924ff0d545c98f.png" alt="请添加图片描述"></p>
<h3 id="1、基本配置："><a href="#1、基本配置：" class="headerlink" title="1、基本配置："></a>1、基本配置：</h3><p>​		根据实验编址表进行相应的基本 IP 地址配置，由于 PC 是通过 DHCP 自动获取地址，暂时无法测试连通性。交换机为二层设备，无需配置 IP 地址。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span> <span class="number">24</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]ip address <span class="number">192.168</span><span class="number">.2</span><span class="number">.254</span> <span class="number">24</span></span><br></pre></td></tr></table></figure>

<h3 id="2、配置基于全局地址池的DHCP-Server"><a href="#2、配置基于全局地址池的DHCP-Server" class="headerlink" title="2、配置基于全局地址池的DHCP Server"></a>2、配置基于全局地址池的DHCP Server</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在 R1 上开启 DHCP 功能。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]dhcp enable</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 ip pool 创建一个全局地址池，地址池名称为 huawei1。缺省情况下，设备上没有创建任何全局地址池。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]ip pool huawei1</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 network 配置全局地址池 huawei1 可动态分配的网段范围为 192.168.1.0，如果不指定掩码，默认使用自然掩码，即 24 位掩码。该网段必需与路由器接口 GE 0/0/0 的 IP地址为同一网段。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei1]network <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="comment">//掩码默认为24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用命令 lease day 配置 DHCP 全局地址池下的地址租期。缺省情况下， IP 地址租期为1 天，对于不同的地址池， DHCP 服务器可以指定不同的地址租用期限，但是同一地址池中的地址具有相同的租期。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei1]lease day <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置 DHCP 客户端的出口网关地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei]gateway-list <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置地址池中 192.168.1.250 到 192.168.1.253 这些地址不参与自动分配。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei1]excluded-ip-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.250</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//由于地址 192.168.1.250 到 192.168.1.253 不参与自动分配，而网关地址也不参与自动分配。 DHCP 服务器将会从地址池中由 192.168.1.249 开始往前分配。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置 DNS 服务器地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei1]dns-list <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//开启接口的 DHCP 功能。使用该命令配置设备指定接口采用全局地址池为客户端分配IP 地址。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span>]dhcp select <span class="variable language_">global</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//由于路由器需要为两个不同部门分配 IP 地址，即需要两个全局地址池。</span></span><br><span class="line"><span class="comment">//为财务部配置的全局地址池名称为： huawei2， IP 网段为 192.168.2.0，网关地址为192.168.2.254， DNS 服务器地址为 8.8.8.8，配置完成后在 GE 0/0/1 接口下面启用全局地址池的 DHCP 服务器模式。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]ip pool huawei2</span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei2]network <span class="number">192.168</span><span class="number">.2</span><span class="number">.0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei2]lease day <span class="number">2</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei2]gateway-list <span class="number">192.168</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei2]dns-list <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ip-pool-huawei2]interface <span class="title class_">GigabitEthernet</span> <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span>]dhcp select <span class="variable language_">global</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，查看 IP 地址池信息。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]display ip pool</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Pool</span>-name : huawei1</span><br><span class="line"><span class="title class_">Pool</span>-<span class="title class_">No</span> : <span class="number">0</span></span><br><span class="line"><span class="title class_">Position</span> : <span class="title class_">Local</span> <span class="title class_">Status</span> : <span class="title class_">Unlocked</span></span><br><span class="line"><span class="title class_">Gateway</span>-<span class="number">0</span> : <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Mask</span> : <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="variable constant_">VPN</span> instance : --</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Pool</span>-name : huawei2</span><br><span class="line"><span class="title class_">Pool</span>-<span class="title class_">No</span> : <span class="number">1</span></span><br><span class="line"><span class="title class_">Position</span> : <span class="title class_">Local</span> <span class="title class_">Status</span> : <span class="title class_">Unlocked</span></span><br><span class="line"><span class="title class_">Gateway</span>-<span class="number">0</span> : <span class="number">192.168</span><span class="number">.2</span><span class="number">.254</span></span><br><span class="line"><span class="title class_">Mask</span> : <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="variable constant_">VPN</span> instance : --</span><br><span class="line"><span class="variable constant_">IP</span> address <span class="title class_">Statistic</span></span><br><span class="line"><span class="title class_">Total</span> :<span class="number">506</span></span><br><span class="line"><span class="title class_">Used</span> :<span class="number">0</span> <span class="title class_">Idle</span> :<span class="number">502</span></span><br><span class="line"><span class="title class_">Expired</span> :<span class="number">0</span> <span class="title class_">Conflict</span> :<span class="number">0</span> <span class="title class_">Disable</span> :<span class="number">4</span></span><br><span class="line"><span class="comment">//通过命令观察到有两个地址池，其中一个地址池为huawei1，另外一个地址池为huawei2，地址池的总数为 506 个，使用了 0 个，空闲 502 个，有 4 个地址不参与分配。</span></span><br></pre></td></tr></table></figure>

<h3 id="3、配置DHCP-Client"><a href="#3、配置DHCP-Client" class="headerlink" title="3、配置DHCP Client"></a>3、配置DHCP Client</h3><p>设置PC-1使用DHCP配置地址，详细步骤见8.1，此处省略。</p>
<h2 id="8-3、配置DHCP中继"><a href="#8-3、配置DHCP中继" class="headerlink" title="8.3、配置DHCP中继"></a>8.3、配置DHCP中继</h2><blockquote>
<p>做完才发现本项目不需要使用到DHCP中继，不想看可跳过</p>
</blockquote>
<p><strong>原理概述：</strong></p>
<p>​		由于在 IP 地址动态获取的过程中，客户端采用广播方式发送请求报文， 而广播报文不能跨网段传送， 因此 DHCP 只适用于 DHCP 客户端和服务器处于同一个网段内的情况。 当多个网段都需要进行动态 IP 地址分配时， 就需要在所有网段上都设置一个 DHCP 服务器，这显然是不易管理和维护的。</p>
<p>​		DHCP 中继使客户端可以通过 DHCP 中继与其他网段的 DHCP 服务器通信，最终获取到 IP 地址。 解决了 DHCP 客户端不能跨网段向服务器动态获取 IP 地址的问题， 这样， 在多个不同网络上的 DHCP 客户端可以使用同一个 DHCP 服务器， 这样既节省了成本，又便于进行集中管理和维护。</p>
<p>​		路由器或三层交换机都可以充当 DHCP 中继设备。 DHCP 中继设备可以转发客户端和服务器间的 DHCP 报文，完成对客户端 IP 地址的动态分配。  </p>
<h2 id="拓扑及设备信息：-11"><a href="#拓扑及设备信息：-11" class="headerlink" title="拓扑及设备信息："></a>拓扑及设备信息：</h2><p>​		本实验模拟企业网络场景， 某公司分部的网络由交换机 S1 和网关路由器 R1 组成，员工终端 PC-1 和 PC-2 都连接在 S1 上。公司要求分部内所有员工主机的 IP 地址都通过总部的 DHCP 服务器自动获取。分部网关路由器 R1 通过公网路由器 R2 访问公司总部的 DHCP服务器 R3。由于公司分部与总部不在同一个子网，需要在 R1 上配置 DHCP 中继，使分部内主机能跨网段从总部的 DHCP 服务器自动获取 IP 地址。</p>
<p><img src="https://img-blog.csdnimg.cn/a1107fdf82fd4e2292093878309ac000.png" alt="请添加图片描述"></p>
<h3 id="1、搭建DHCP网络"><a href="#1、搭建DHCP网络" class="headerlink" title="1、搭建DHCP网络"></a>1、搭建DHCP网络</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在公司路由器 R1， R2， R3 上都配置运行 OSPF 协议，所有网段都发布到区域 0 中。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">200.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R1</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R2</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R2</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R2</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">200.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R2</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">100.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="variable constant_">R3</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R3</span>-ospf-<span class="number">1</span>]area <span class="number">0</span></span><br><span class="line">[<span class="variable constant_">R3</span>-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">100.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置完成后，查看路由表信息。</span></span><br><span class="line">&lt;<span class="variable constant_">R1</span>&gt;display ip routing-table</span><br><span class="line"><span class="title class_">Route</span> <span class="title class_">Flags</span>: R - relay, D - download to fib</span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"><span class="title class_">Routing</span> <span class="title class_">Tables</span>: <span class="title class_">Public</span></span><br><span class="line"><span class="title class_">Destinations</span> : <span class="number">7</span> <span class="title class_">Routes</span> : <span class="number">7</span></span><br><span class="line"><span class="title class_">Destination</span>/<span class="title class_">Mask</span> <span class="title class_">Proto</span> <span class="title class_">Pre</span> <span class="title class_">Cost</span> <span class="title class_">Flags</span> <span class="title class_">NextHop</span> <span class="title class_">Interface</span></span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span> <span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span>/<span class="number">32</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="number">100.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="variable constant_">OSPF</span> <span class="number">10</span> D <span class="number">200.1</span><span class="number">.1</span><span class="number">.2</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="title class_">InLoopBack0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/<span class="number">32</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="title class_">InLoopBack0</span></span><br><span class="line"><span class="number">200.1</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">200.1</span><span class="number">.1</span><span class="number">.1</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="number">200.1</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">32</span> <span class="title class_">Direct</span> <span class="number">0</span> <span class="number">0</span> D <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="title class_">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="variable constant_">R2</span>&gt;display ip routing-table</span><br><span class="line">...</span><br><span class="line">&lt;<span class="variable constant_">R3</span>&gt;display ip routing-table</span><br><span class="line">...</span><br><span class="line"><span class="comment">//可以观察到，目前每台设备都可以正常获得路由信息，连通性测试省略。</span></span><br></pre></td></tr></table></figure>

<h3 id="2、配置DHCP服务器"><a href="#2、配置DHCP服务器" class="headerlink" title="2、配置DHCP服务器"></a>2、配置DHCP服务器</h3><p>​		总部路由器 R3 配置为 DHCP 服务器，负责为分部的网络分配 IP 地址。在 R3 上使用命令dhcp enable开启DHCP功能，创建全局地址池dhcp-pool，可分配IP地址范围为10.1.1.0&#x2F;24，出口网关地址为 10.1.1.254。并在面向 DHCP 中继设备的接口上开启 DHCP 服务功能，指定从全局地址池分配地址。 </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="variable constant_">R3</span>]dhcp enable</span><br><span class="line"><span class="title class_">Info</span>: <span class="title class_">The</span> operation may take a few seconds. <span class="title class_">Please</span> wait <span class="keyword">for</span> a moment.<span class="property">done</span>.</span><br><span class="line">[<span class="variable constant_">R3</span>]ip pool dhcp-pool</span><br><span class="line"><span class="title class_">Info</span>:<span class="title class_">It</span><span class="string">&#x27;s successful to create an IP address pool.</span></span><br><span class="line"><span class="string">[R3-ip-pool-dhcp-pool]network 10.1.1.0 mask 255.255.255.0</span></span><br><span class="line"><span class="string">[R3-ip-pool-dhcp-pool]gateway-list 10.1.1.254</span></span><br><span class="line"><span class="string">[R3-ip-pool-dhcp-pool]interface GigabitEthernet0/0/1</span></span><br><span class="line"><span class="string">[R3-GigabitEthernet0/0/1]dhcp select global</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//配置完成后，使用命令 display ip pool 查看 IP 地址池配置情况。</span></span><br><span class="line"><span class="string">[R3]display ip pool</span></span><br><span class="line"><span class="string">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="string">Pool-name : dhcp-pool</span></span><br><span class="line"><span class="string">Pool-No : 0</span></span><br><span class="line"><span class="string">Position : Local Status : Unlocked</span></span><br><span class="line"><span class="string">Gateway-0 : 10.1.1.254</span></span><br><span class="line"><span class="string">Mask : 255.255.255.0</span></span><br><span class="line"><span class="string">VPN instance : --</span></span><br><span class="line"><span class="string">IP address Statistic</span></span><br><span class="line"><span class="string">Total :253</span></span><br><span class="line"><span class="string">Used :0 Idle :253</span></span><br><span class="line"><span class="string">Expired :0 Conflict :0 Disable :0</span></span><br><span class="line"><span class="string">//可以观察到，当前可用的地址除去网关 IP 以外还剩下 253 个可用， 目前还没有 PC 动态申请 IP 地址。</span></span><br></pre></td></tr></table></figure>

<h3 id="3、配置DHCP中继"><a href="#3、配置DHCP中继" class="headerlink" title="3、配置DHCP中继"></a>3、配置DHCP中继</h3><p>​		配置 R1 为 DHCP 中继设备，指定 DHCP 服务器为 R3。</p>
<p>​		这时如果 R1 从 E 0&#x2F;0&#x2F;1 接口收到 PC 的 DHCP 广播请求包， R1 作为 DHCP 中继设备会以单播形式转发请求包到中继所指明的 DHCP 服务器 R3，服务器 R3 收到 DHCP 请求包后，会把分配的 IP 地址通过单播包返回给 DHCP 中继设备 R1，中继设备 R1 再把地址信息发送给 PC。所以在 DHCP 中继上需要指定所代理的 DHCP 服务器的地址。</p>
<p>​		配置指定 DHCP 服务器有两种方式，<u>一种方式是在面向 PC 的接口下直接配置 DHCP服务器 IP 地址</u>。另外<u>一种方式是在面向 PC 的接口下调用全局定义的 DHCP 服务器组</u>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第一种配置方法：直接在 R1 的 E 0/0/1 接口下开启 DHCP 中继功能，并直接指定 DHCP服务器 IP 地址为 100.1.1.1。  </span></span><br><span class="line">[<span class="variable constant_">R1</span>]dhcp enable</span><br><span class="line">[<span class="variable constant_">R1</span>]interface <span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span>]dhcp select relay</span><br><span class="line">[<span class="variable constant_">R1</span>-<span class="title class_">Ethernet1</span>/<span class="number">0</span>/<span class="number">1</span>]dhcp relay server-ip <span class="number">100.1</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第二种配置方法：在 R1 上创建 DHCP 服务器组，指定组名为 dhcp-group，并使用dhcp-server 命令添加远端的 DHCP 服务器地址。接着在 E 0/0/1 接口下开启 DHCP 中继功能并配置所对应的 DHCP 服务器组。</span></span><br><span class="line">[<span class="variable constant_">R1</span>]dhcp server group dhcp-group</span><br><span class="line"><span class="title class_">Info</span>:<span class="title class_">It</span><span class="string">&#x27;s successful to create a DHCP server group.</span></span><br><span class="line"><span class="string">[R1-dhcp-server-group-dhcp-group]dhcp-server 100.1.1.1</span></span><br><span class="line"><span class="string">[R1-dhcp-server-group-dhcp-group]interface Ethernet1/0/1</span></span><br><span class="line"><span class="string">[R1-Ethernet1/0/1]dhcp select relay</span></span><br><span class="line"><span class="string">[R1-Ethernet1/0/1]dhcp relay server-select dhcp-group</span></span><br></pre></td></tr></table></figure>

<p>​		两种方式均能达到同样的配置要求。相比而言，在接口下直接指定 DHCP 服务器 IP 地址的方式较简单，但如果中继设备上有多个接口需要配置 DHCP 中继功能，则要在所有接口上重复同样的配置，产生的配置量较大。而如果使用服务器组的方式，则可以仅在全局定义一次，在每个接口重复调用，尤其是当有多个 DHCP 服务器或者服务器 IP 地址需要更改的时候尤为方便。</p>
<h3 id="4、配置PC获取地址方式为DHCP"><a href="#4、配置PC获取地址方式为DHCP" class="headerlink" title="4、配置PC获取地址方式为DHCP"></a>4、配置PC获取地址方式为DHCP</h3><p>详细方法见8.1，配置完成后测试连通性。</p>
<p>​		整个配置过程，仅在网关路由器 R1 上开启 DHCP 中继功能，在分部没有其它过多的DHCP 配置。 在网络设计和管理中灵活使用 DHCP 中继功能能够使网络运行更加高效和方便。</p>
<h1 id="9、其他配置"><a href="#9、其他配置" class="headerlink" title="9、其他配置"></a>9、其他配置</h1><p><strong>配置Server-DNS：</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_53466908/article/details/125400356">https://blog.csdn.net/weixin_53466908/article/details/125400356</a></p>
<p><strong>关于DMZ区域：</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42563968/article/details/108789588">https://blog.csdn.net/weixin_42563968/article/details/108789588</a></p>
<p><strong>AC+AP配置参考：</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50281314/article/details/125028672">https://blog.csdn.net/weixin_50281314/article/details/125028672</a></p>
<p><strong>DHCP配置：</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/tryheart/article/details/107792913">https://blog.csdn.net/tryheart/article/details/107792913</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">MERCURZY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/06/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A102/">http://example.com/2022/11/06/网络工程设计02/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">M3RCUR2Y</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/">自学笔记</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><a class="post-meta__tags" href="/tags/esnp/">esnp</a></div><div class="post_share"><div class="social-share" data-image="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/30/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80-html%E4%B8%8Ecss/"><img class="prev-cover" src="https://img-blog.csdnimg.cn/img_convert/f5094b78445019abdb82fe7be34dde42.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">前端基础-html与css</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/05/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A101/"><img class="next-cover" src="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网络工程设计01——计算机网络基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/11/05/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A101/" title="网络工程设计01——计算机网络基础"><img class="cover" src="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-05</div><div class="title">网络工程设计01——计算机网络基础</div></div></a></div><div><a href="/2022/10/30/Mysql%E5%9F%BA%E7%A1%80/" title="Mysql基础"><img class="cover" src="https://img-blog.csdnimg.cn/img_convert/f5094b78445019abdb82fe7be34dde42.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-30</div><div class="title">Mysql基础</div></div></a></div><div><a href="/2022/11/30/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80-html%E4%B8%8Ecss/" title="前端基础-html与css"><img class="cover" src="https://img-blog.csdnimg.cn/img_convert/f5094b78445019abdb82fe7be34dde42.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-30</div><div class="title">前端基础-html与css</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://img-blog.csdnimg.cn/img_convert/24c7fae59b92b7310428f816c7bec119.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">MERCURZY</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/M3RCUR2Y"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">图床用的是github，快速访问需要科学上网</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81VRP%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-text">1、VRP基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E3%80%81%E9%80%9A%E8%BF%87Telent%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F"><span class="toc-text">1.1、通过Telent登录系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE-Telnet-%E7%9A%84%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81"><span class="toc-text">1、配置 Telnet 的密码验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81-%E9%85%8D%E7%BD%AE-Telnet-%E5%8C%BA%E5%88%86%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-text">2、 配置 Telnet 区分不同用户的权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E3%80%81%E9%80%9A%E8%BF%87FTP%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-text">1.2、通过FTP进行文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-1"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B8%BAFTP-Client"><span class="toc-text">1、配置路由器为FTP Client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B8%BAFTP-Server"><span class="toc-text">2、配置路由器为FTP Server</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-text">2、交换机基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-text">2.1、交换机基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-2"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E9%80%9F%E7%8E%87"><span class="toc-text">2、配置接口速率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E3%80%81ARP%E5%8F%8AProxy-ARP"><span class="toc-text">2.2、ARP及Proxy ARP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81VLAN"><span class="toc-text">3、VLAN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E3%80%81VLAN-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E5%8F%8A-Access-%E6%8E%A5%E5%8F%A3"><span class="toc-text">3.1、VLAN 基础配置及 Access 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-3"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAVLAN"><span class="toc-text">1、创建VLAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEAccess%E6%8E%A5%E5%8F%A3"><span class="toc-text">2、配置Access接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-text">3、检查配置结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E3%80%81%E9%85%8D%E7%BD%AETrunk%E6%8E%A5%E5%8F%A3"><span class="toc-text">3.2、配置Trunk接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-4"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAVLAN%EF%BC%8C%E9%85%8D%E7%BD%AEAccess%E6%8E%A5%E5%8F%A3"><span class="toc-text">1、创建VLAN，配置Access接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AETrunk%E6%8E%A5%E5%8F%A3"><span class="toc-text">2、配置Trunk接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3%E3%80%81%E5%88%A9%E7%94%A8%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0-VLAN-%E9%97%B4%E8%B7%AF%E7%94%B1"><span class="toc-text">3.3、利用单臂路由实现 VLAN 间路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-5"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAVLAN%E5%B9%B6%E9%85%8D%E7%BD%AEAccess%E3%80%81Trunk%E6%8E%A5%E5%8F%A3"><span class="toc-text">1、创建VLAN并配置Access、Trunk接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%AD%90%E6%8E%A5%E5%8F%A3%E5%92%8CIP%E5%9C%B0%E5%9D%80"><span class="toc-text">2、配置路由器子接口和IP地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%AD%90%E6%8E%A5%E5%8F%A3%E5%B0%81%E8%A3%85VLAN"><span class="toc-text">3、配置路由器子接口封装VLAN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%EF%BC%9A"><span class="toc-text">常用操作：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81%E7%94%9F%E6%88%90%E6%A0%91"><span class="toc-text">4、生成树</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81STP%E9%85%8D%E7%BD%AE%E5%92%8C%E9%80%89%E8%B7%AF%E8%A7%84%E5%88%99"><span class="toc-text">4.1、STP配置和选路规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-6"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">1、基本配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E6%A0%B9%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-text">2、配置网络中的根交换机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%90%86%E8%A7%A3%E6%A0%B9%E7%AB%AF%E5%8F%A3%E7%9A%84%E9%80%89%E4%B8%BE"><span class="toc-text">3、理解根端口的选举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%90%86%E8%A7%A3%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E7%9A%84%E9%80%89%E4%B8%BE"><span class="toc-text">4、理解指定端口的选举</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E5%85%B6%E4%BB%96%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF"><span class="toc-text">5、其他交换技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E3%80%81Eth-Trunk%E9%93%BE%E8%B7%AF%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF"><span class="toc-text">5.1、Eth-Trunk链路交换技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-1"><span class="toc-text">1、基本配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%9C%AA%E9%85%8D%E7%BD%AEEth-Trunk%E6%97%B6%E7%9A%84%E7%8E%B0%E8%B1%A1%E9%AA%8C%E8%AF%81"><span class="toc-text">2、未配置Eth-Trunk时的现象验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AEEth-Trunk%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%EF%BC%88%E6%89%8B%E5%B7%A5%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-text">3、配置Eth-Trunk实现链路聚合（手工负载分担模式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E9%85%8D%E7%BD%AEEth-Trunk%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%EF%BC%88%E9%9D%99%E6%80%81LACP%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-text">4、配置Eth-Trunk实现链路聚合（静态LACP模式）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81OSPF"><span class="toc-text">6、OSPF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1%E3%80%81OSPF%E5%8D%95%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE"><span class="toc-text">6.1、OSPF单区域设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-7"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%83%A8%E7%BD%B2%E5%8D%95%E5%8C%BA%E5%9F%9FOSPF%E7%BD%91%E7%BB%9C"><span class="toc-text">1、部署单区域OSPF网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%A3%80%E6%9F%A5OSPF%E5%8D%95%E5%8C%BA%E5%9F%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-text">2、检查OSPF单区域的配置结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%E3%80%81%E4%BD%BF%E7%94%A8OSPF%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1"><span class="toc-text">6.2、使用OSPF默认路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81OSPF%E4%B8%8B%E6%94%BE%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">1、OSPF下放默认路由的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81OSPF%E4%B8%8B%E6%94%BE%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">2、OSPF下放默认路由的方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%E3%80%81VRRP"><span class="toc-text">7、VRRP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1%E3%80%81VRRP%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">7.1、VRRP基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-8"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%83%A8%E7%BD%B2OSPF%E7%BD%91%E7%BB%9C"><span class="toc-text">1、部署OSPF网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEVRRP%E5%8D%8F%E8%AE%AE"><span class="toc-text">2、配置VRRP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%AA%8C%E8%AF%81VRRP%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2"><span class="toc-text">3、验证VRRP主备切换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8%E3%80%81DHCP"><span class="toc-text">8、DHCP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1%E3%80%81%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E6%B1%A0%E7%9A%84DHCP"><span class="toc-text">8.1、配置基于接口地址池的DHCP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-9"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-2"><span class="toc-text">1、基本配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AEDHCP-Server-%E5%8A%9F%E8%83%BD"><span class="toc-text">2、基于接口配置DHCP Server 功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E7%9A%84DHCP-Server-%E7%A7%9F%E6%9C%9F-x2F-DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80"><span class="toc-text">3、配置基于接口的DHCP Server 租期&#x2F;DNS 服务器地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E9%85%8D%E7%BD%AEDHCP-Client"><span class="toc-text">4、配置DHCP Client</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2%E3%80%81%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8E%E5%85%A8%E5%B1%80%E5%9C%B0%E5%9D%80%E6%B1%A0%E7%9A%84DHCP"><span class="toc-text">8.2、配置基于全局地址池的DHCP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-10"><span class="toc-text">拓扑及设备信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-text">1、基本配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8E%E5%85%A8%E5%B1%80%E5%9C%B0%E5%9D%80%E6%B1%A0%E7%9A%84DHCP-Server"><span class="toc-text">2、配置基于全局地址池的DHCP Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AEDHCP-Client"><span class="toc-text">3、配置DHCP Client</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3%E3%80%81%E9%85%8D%E7%BD%AEDHCP%E4%B8%AD%E7%BB%A7"><span class="toc-text">8.3、配置DHCP中继</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E5%8F%8A%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9A-11"><span class="toc-text">拓扑及设备信息：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%90%AD%E5%BB%BADHCP%E7%BD%91%E7%BB%9C"><span class="toc-text">1、搭建DHCP网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEDHCP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">2、配置DHCP服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AEDHCP%E4%B8%AD%E7%BB%A7"><span class="toc-text">3、配置DHCP中继</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E9%85%8D%E7%BD%AEPC%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9D%80%E6%96%B9%E5%BC%8F%E4%B8%BADHCP"><span class="toc-text">4、配置PC获取地址方式为DHCP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9%E3%80%81%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-text">9、其他配置</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/30/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80-html%E4%B8%8Ecss/" title="前端基础-html与css"><img src="https://img-blog.csdnimg.cn/img_convert/f5094b78445019abdb82fe7be34dde42.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端基础-html与css"/></a><div class="content"><a class="title" href="/2022/11/30/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80-html%E4%B8%8Ecss/" title="前端基础-html与css">前端基础-html与css</a><time datetime="2022-11-29T22:50:46.000Z" title="发表于 2022-11-30 06:50:46">2022-11-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/06/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A102/" title="网络工程设计02——ensp基础"><img src="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络工程设计02——ensp基础"/></a><div class="content"><a class="title" href="/2022/11/06/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A102/" title="网络工程设计02——ensp基础">网络工程设计02——ensp基础</a><time datetime="2022-11-06T15:38:11.000Z" title="发表于 2022-11-06 23:38:11">2022-11-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/05/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A101/" title="网络工程设计01——计算机网络基础"><img src="https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络工程设计01——计算机网络基础"/></a><div class="content"><a class="title" href="/2022/11/05/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A101/" title="网络工程设计01——计算机网络基础">网络工程设计01——计算机网络基础</a><time datetime="2022-11-04T19:16:05.000Z" title="发表于 2022-11-05 03:16:05">2022-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/30/Mysql%E5%9F%BA%E7%A1%80/" title="Mysql基础"><img src="https://img-blog.csdnimg.cn/img_convert/f5094b78445019abdb82fe7be34dde42.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mysql基础"/></a><div class="content"><a class="title" href="/2022/10/30/Mysql%E5%9F%BA%E7%A1%80/" title="Mysql基础">Mysql基础</a><time datetime="2022-10-29T16:47:01.000Z" title="发表于 2022-10-30 00:47:01">2022-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/28/hello-world/" title="Hello World"><img src="https://img-blog.csdnimg.cn/img_convert/f5094b78445019abdb82fe7be34dde42.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2022/10/28/hello-world/" title="Hello World">Hello World</a><time datetime="2022-10-28T08:20:19.883Z" title="发表于 2022-10-28 16:20:19">2022-10-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://img-blog.csdnimg.cn/img_convert/a35960982d44f0e7cac10ba248718743.jpeg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By MERCURZY</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>